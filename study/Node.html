<!DOCTYPE html>
<html lang="en-US" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Node.js | Kinght的小屋</title>
    <meta name="description" content="A VitePress site">
    <link rel="preload stylesheet" href="/note-blog/assets/style.aee24150.css" as="style">
    
    <script type="module" src="/note-blog/assets/app.9d58359b.js"></script>
    <link rel="preload" href="/note-blog/assets/inter-roman-latin.2ed14f66.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/note-blog/assets/chunks/framework.f98883f0.js">
    <link rel="modulepreload" href="/note-blog/assets/chunks/theme.c91d5828.js">
    <link rel="modulepreload" href="/note-blog/assets/chunks/giscus-2a044aea.497f0bd4.js">
    <link rel="modulepreload" href="/note-blog/assets/study_Node.md.4fadfdf0.lean.js">
    <link rel="icon" type="image/svg+xml" href="/icon/vite.svg">
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-80a8ecb8><!--[--><!--]--><!--[--><span tabindex="-1" data-v-5d1f4d31></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-5d1f4d31> Skip to content </a><!--]--><!----><header class="VPNav" data-v-80a8ecb8 data-v-d76b8b84><div class="VPNavBar has-sidebar" data-v-d76b8b84 data-v-0e557797><div class="container" data-v-0e557797><div class="title" data-v-0e557797><div class="VPNavBarTitle has-sidebar" data-v-0e557797 data-v-684e05bc><a class="title" href="/note-blog/" data-v-684e05bc><!--[--><!--]--><!----><!--[-->Kinght的小屋<!--]--><!--[--><!--]--></a></div></div><div class="content" data-v-0e557797><div class="curtain" data-v-0e557797></div><div class="content-body" data-v-0e557797><!--[--><!--]--><div class="VPNavBarSearch search" data-v-0e557797><!--[--><!----><div id="local-search"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg class="DocSearch-Search-Icon" width="20" height="20" viewBox="0 0 20 20" aria-label="search icon"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"><kbd class="DocSearch-Button-Key"></kbd><kbd class="DocSearch-Button-Key">K</kbd></span></button></div><!--]--></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-0e557797 data-v-91f2b859><span id="main-nav-aria-label" class="visually-hidden" data-v-91f2b859>Main Navigation</span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/note-blog/guide.html" tabindex="0" data-v-91f2b859 data-v-4c8233c7><!--[--><span data-v-4c8233c7>开始</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/note-blog/study.html" tabindex="0" data-v-91f2b859 data-v-4c8233c7><!--[--><span data-v-4c8233c7>学习</span><!--]--></a><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-91f2b859 data-v-2505eafb><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-2505eafb><span class="text" data-v-2505eafb><!----><span data-v-2505eafb>八股</span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="text-icon" data-v-2505eafb><path d="M12,16c-0.3,0-0.5-0.1-0.7-0.3l-6-6c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l5.3,5.3l5.3-5.3c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-6,6C12.5,15.9,12.3,16,12,16z"></path></svg></span></button><div class="menu" data-v-2505eafb><div class="VPMenu" data-v-2505eafb data-v-c68a7715><div class="items" data-v-c68a7715><!--[--><!--[--><div class="VPMenuLink" data-v-c68a7715 data-v-d8b54ed1><a class="VPLink link" href="/note-blog/interview/html.html" data-v-d8b54ed1><!--[-->HTML<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-c68a7715 data-v-d8b54ed1><a class="VPLink link" href="/note-blog/interview/css.html" data-v-d8b54ed1><!--[-->CSS<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-c68a7715 data-v-d8b54ed1><a class="VPLink link" href="/note-blog/interview/js.html" data-v-d8b54ed1><!--[-->JS<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-c68a7715 data-v-d8b54ed1><a class="VPLink link" href="/note-blog/interview/ts.html" data-v-d8b54ed1><!--[-->TS<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-c68a7715 data-v-d8b54ed1><a class="VPLink link" href="/note-blog/interview/other.html" data-v-d8b54ed1><!--[-->其他<!--]--></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/note-blog/question.html" tabindex="0" data-v-91f2b859 data-v-4c8233c7><!--[--><span data-v-4c8233c7>踩过的坑</span><!--]--></a><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-0e557797 data-v-de4e22d9><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title="toggle dark mode" aria-checked="false" data-v-de4e22d9 data-v-030fe3a0 data-v-014ad383><span class="check" data-v-014ad383><span class="icon" data-v-014ad383><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-030fe3a0><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-030fe3a0><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></div><!----><div class="VPFlyout VPNavBarExtra extra" data-v-0e557797 data-v-8392895e data-v-2505eafb><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-2505eafb><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="icon" data-v-2505eafb><circle cx="12" cy="12" r="2"></circle><circle cx="19" cy="12" r="2"></circle><circle cx="5" cy="12" r="2"></circle></svg></button><div class="menu" data-v-2505eafb><div class="VPMenu" data-v-2505eafb data-v-c68a7715><!----><!--[--><!--[--><!----><div class="group" data-v-8392895e><div class="item appearance" data-v-8392895e><p class="label" data-v-8392895e>Appearance</p><div class="appearance-action" data-v-8392895e><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title="toggle dark mode" aria-checked="false" data-v-8392895e data-v-030fe3a0 data-v-014ad383><span class="check" data-v-014ad383><span class="icon" data-v-014ad383><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-030fe3a0><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-030fe3a0><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></div></div></div><!----><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-0e557797 data-v-5a5d550b><span class="container" data-v-5a5d550b><span class="top" data-v-5a5d550b></span><span class="middle" data-v-5a5d550b></span><span class="bottom" data-v-5a5d550b></span></span></button></div></div></div></div><!----></header><div class="VPLocalNav reached-top" data-v-80a8ecb8 data-v-e9fd9911><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-e9fd9911><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="menu-icon" data-v-e9fd9911><path d="M17,11H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h14c0.6,0,1,0.4,1,1S17.6,11,17,11z"></path><path d="M21,7H3C2.4,7,2,6.6,2,6s0.4-1,1-1h18c0.6,0,1,0.4,1,1S21.6,7,21,7z"></path><path d="M21,15H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h18c0.6,0,1,0.4,1,1S21.6,15,21,15z"></path><path d="M17,19H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h14c0.6,0,1,0.4,1,1S17.6,19,17,19z"></path></svg><span class="menu-text" data-v-e9fd9911>Menu</span></button><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-e9fd9911 data-v-75385524><button data-v-75385524>Return to top</button><!----></div></div><aside class="VPSidebar" data-v-80a8ecb8 data-v-69fb9f58><div class="curtain" data-v-69fb9f58></div><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-69fb9f58><span class="visually-hidden" id="sidebar-aria-label" data-v-69fb9f58> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="group" data-v-69fb9f58><section class="VPSidebarItem level-0 has-active" data-v-69fb9f58 data-v-d0912435><!----><div class="items" data-v-d0912435><!--[--><div class="VPSidebarItem level-1 is-link" data-v-d0912435 data-v-d0912435><div class="item" data-v-d0912435><div class="indicator" data-v-d0912435></div><a class="VPLink link link" href="/note-blog/study/Nest.html" data-v-d0912435><!--[--><p class="text" data-v-d0912435>Nest</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-d0912435 data-v-d0912435><div class="item" data-v-d0912435><div class="indicator" data-v-d0912435></div><a class="VPLink link link" href="/note-blog/study/Next.html" data-v-d0912435><!--[--><p class="text" data-v-d0912435>Next</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-d0912435 data-v-d0912435><div class="item" data-v-d0912435><div class="indicator" data-v-d0912435></div><a class="VPLink link link" href="/note-blog/study/Node.html" data-v-d0912435><!--[--><p class="text" data-v-d0912435>Node</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-d0912435 data-v-d0912435><div class="item" data-v-d0912435><div class="indicator" data-v-d0912435></div><a class="VPLink link link" href="/note-blog/study/Nuxt.html" data-v-d0912435><!--[--><p class="text" data-v-d0912435>Nuxt</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-d0912435 data-v-d0912435><div class="item" data-v-d0912435><div class="indicator" data-v-d0912435></div><a class="VPLink link link" href="/note-blog/study/React.html" data-v-d0912435><!--[--><p class="text" data-v-d0912435>React</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-d0912435 data-v-d0912435><div class="item" data-v-d0912435><div class="indicator" data-v-d0912435></div><a class="VPLink link link" href="/note-blog/study/Vitepress.html" data-v-d0912435><!--[--><p class="text" data-v-d0912435>Vitepress</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><!--]--><!--[--><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-80a8ecb8 data-v-c2d39941><div class="VPDoc has-sidebar has-aside" data-v-c2d39941 data-v-05ecd897><!--[--><!--]--><div class="container" data-v-05ecd897><div class="aside" data-v-05ecd897><div class="aside-curtain" data-v-05ecd897></div><div class="aside-container" data-v-05ecd897><div class="aside-content" data-v-05ecd897><div class="VPDocAside" data-v-05ecd897 data-v-15ee8eb8><!--[--><!--]--><!--[--><!--]--><div class="VPDocAsideOutline" role="navigation" data-v-15ee8eb8 data-v-1d4a8cd0><div class="content" data-v-1d4a8cd0><div class="outline-marker" data-v-1d4a8cd0></div><div class="outline-title" role="heading" aria-level="2" data-v-1d4a8cd0>On this page</div><nav aria-labelledby="doc-outline-aria-label" data-v-1d4a8cd0><span class="visually-hidden" id="doc-outline-aria-label" data-v-1d4a8cd0> Table of Contents for current page </span><ul class="root" data-v-1d4a8cd0 data-v-ef13fba0><!--[--><!--]--></ul></nav></div></div><!--[--><!--]--><div class="spacer" data-v-15ee8eb8></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-05ecd897><div class="content-container" data-v-05ecd897><!--[--><!--]--><!----><main class="main" data-v-05ecd897><div style="position:relative;" class="vp-doc _note-blog_study_Node" data-v-05ecd897><div><h1 id="http-模块" tabindex="-1">http 模块 <a class="header-anchor" href="#http-模块" aria-label="Permalink to &quot;http 模块&quot;">​</a></h1><h2 id="get-发送-http-请求" tabindex="-1">get 发送 http 请求 <a class="header-anchor" href="#get-发送-http-请求" aria-label="Permalink to &quot;get 发送 http 请求&quot;">​</a></h2><p>Node.js 环境也提供了发送请求的功能，由于不在浏览器环境下所以不受同源策略的限制，可以任意发送请求。<strong>http 模块提供了 get 函数</strong>，可以用来发送 http 请求，若想发送 https 请求需要使用 https 模块的 get 函数。</p><h3 id="使用方式" tabindex="-1">使用方式 <a class="header-anchor" href="#使用方式" aria-label="Permalink to &quot;使用方式&quot;">​</a></h3><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">http.</span><span style="color:#B392F0;">get</span><span style="color:#E1E4E8;">(options, (</span><span style="color:#FFAB70;">res</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;">/*响应成功的回调*/</span></span>
<span class="line"><span style="color:#E1E4E8;">});</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">http.</span><span style="color:#6F42C1;">get</span><span style="color:#24292E;">(options, (</span><span style="color:#E36209;">res</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6A737D;">/*响应成功的回调*/</span></span>
<span class="line"><span style="color:#24292E;">});</span></span></code></pre></div><h3 id="获取响应内容" tabindex="-1">获取响应内容 <a class="header-anchor" href="#获取响应内容" aria-label="Permalink to &quot;获取响应内容&quot;">​</a></h3><ol><li><p>在 get 方法的第二个参数是一个函数，函数接收一个 res 参数，该参数是响应报文，有响应头部等等相关信息。通过 res.on 方法来监听目的服务器相关的事件如<code>data</code>有数据传输时，<code>end</code>数据传输结束时，<code>error</code>响应错误时。</p></li><li><p>通过<code> res.on(&#39;data&#39;,(chuck)=&gt;{})</code>可以监听每次有数据传输过来时，可以执行的回调，回调接收一个 chuck 参数，chuck 就是目的服务器响应回来的内容，由于不确定是不是<strong>分段传输</strong>，我们需要不断接收保存目的服务器传输过来的数据。</p></li><li><p>通过 <code>res.on(&#39;end&#39;,()=&gt;{})</code>可以监听响应结束的回调，可以将保存的数据合并。</p></li></ol><h3 id="简单示例" tabindex="-1">简单示例 <a class="header-anchor" href="#简单示例" aria-label="Permalink to &quot;简单示例&quot;">​</a></h3><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">function</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">get</span><span style="color:#E1E4E8;">(</span><span style="color:#FFAB70;">options</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">Promise</span><span style="color:#E1E4E8;">((</span><span style="color:#FFAB70;">resolve</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">reject</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">request</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> http.</span><span style="color:#B392F0;">get</span><span style="color:#E1E4E8;">(options, (</span><span style="color:#FFAB70;">res</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">buffer</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> [];</span></span>
<span class="line"><span style="color:#E1E4E8;">      res.</span><span style="color:#B392F0;">on</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;data&quot;</span><span style="color:#E1E4E8;">, (</span><span style="color:#FFAB70;">chunk</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#6A737D;">// 每当响应有数据传输时，保存数据</span></span>
<span class="line"><span style="color:#E1E4E8;">        buffer.</span><span style="color:#B392F0;">push</span><span style="color:#E1E4E8;">(chunk);</span></span>
<span class="line"><span style="color:#E1E4E8;">      });</span></span>
<span class="line"><span style="color:#E1E4E8;">      res.</span><span style="color:#B392F0;">on</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;end&quot;</span><span style="color:#E1E4E8;">, () </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#6A737D;">// 结束响应了</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#B392F0;">resolve</span><span style="color:#E1E4E8;">({</span></span>
<span class="line"><span style="color:#E1E4E8;">          headers: res.headers,</span></span>
<span class="line"><span style="color:#E1E4E8;">          data: Buffer.</span><span style="color:#B392F0;">concat</span><span style="color:#E1E4E8;">(buffer),</span></span>
<span class="line"><span style="color:#E1E4E8;">        });</span></span>
<span class="line"><span style="color:#E1E4E8;">      });</span></span>
<span class="line"><span style="color:#E1E4E8;">    });</span></span>
<span class="line"><span style="color:#E1E4E8;">    request.</span><span style="color:#B392F0;">on</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;error&quot;</span><span style="color:#E1E4E8;">, (</span><span style="color:#FFAB70;">error</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#B392F0;">reject</span><span style="color:#E1E4E8;">(error);</span></span>
<span class="line"><span style="color:#E1E4E8;">    });</span></span>
<span class="line"><span style="color:#E1E4E8;">    request.</span><span style="color:#B392F0;">end</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">  });</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">function</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">get</span><span style="color:#24292E;">(</span><span style="color:#E36209;">options</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">Promise</span><span style="color:#24292E;">((</span><span style="color:#E36209;">resolve</span><span style="color:#24292E;">, </span><span style="color:#E36209;">reject</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">request</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> http.</span><span style="color:#6F42C1;">get</span><span style="color:#24292E;">(options, (</span><span style="color:#E36209;">res</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">buffer</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> [];</span></span>
<span class="line"><span style="color:#24292E;">      res.</span><span style="color:#6F42C1;">on</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;data&quot;</span><span style="color:#24292E;">, (</span><span style="color:#E36209;">chunk</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6A737D;">// 每当响应有数据传输时，保存数据</span></span>
<span class="line"><span style="color:#24292E;">        buffer.</span><span style="color:#6F42C1;">push</span><span style="color:#24292E;">(chunk);</span></span>
<span class="line"><span style="color:#24292E;">      });</span></span>
<span class="line"><span style="color:#24292E;">      res.</span><span style="color:#6F42C1;">on</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;end&quot;</span><span style="color:#24292E;">, () </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6A737D;">// 结束响应了</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6F42C1;">resolve</span><span style="color:#24292E;">({</span></span>
<span class="line"><span style="color:#24292E;">          headers: res.headers,</span></span>
<span class="line"><span style="color:#24292E;">          data: Buffer.</span><span style="color:#6F42C1;">concat</span><span style="color:#24292E;">(buffer),</span></span>
<span class="line"><span style="color:#24292E;">        });</span></span>
<span class="line"><span style="color:#24292E;">      });</span></span>
<span class="line"><span style="color:#24292E;">    });</span></span>
<span class="line"><span style="color:#24292E;">    request.</span><span style="color:#6F42C1;">on</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;error&quot;</span><span style="color:#24292E;">, (</span><span style="color:#E36209;">error</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#6F42C1;">reject</span><span style="color:#24292E;">(error);</span></span>
<span class="line"><span style="color:#24292E;">    });</span></span>
<span class="line"><span style="color:#24292E;">    request.</span><span style="color:#6F42C1;">end</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">  });</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre></div><h3 id="捕获请求错误" tabindex="-1">捕获请求错误 <a class="header-anchor" href="#捕获请求错误" aria-label="Permalink to &quot;捕获请求错误&quot;">​</a></h3><p>http.get()返回一个 request 对象，可以监听请求事件，如 error，监听错误请求。</p><h2 id="请求上下文-请求对象" tabindex="-1">请求上下文（请求对象） <a class="header-anchor" href="#请求上下文-请求对象" aria-label="Permalink to &quot;请求上下文（请求对象）&quot;">​</a></h2><p>在监听 http 实例的 request 事件时，每次向目标服务器发送请求就会触发 request 事件。 通过 on 方法来监听 request 事件，第二个参数接收一个回调，回调可以接收两个参数，第一个就是请求上下文，第二个就是响应上下文。</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">// 如何监听http实例的request事件?</span></span>
<span class="line"><span style="color:#E1E4E8;">server.</span><span style="color:#B392F0;">on</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;request&quot;</span><span style="color:#E1E4E8;">, (</span><span style="color:#FFAB70;">requset</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {});</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">// 如何监听http实例的request事件?</span></span>
<span class="line"><span style="color:#24292E;">server.</span><span style="color:#6F42C1;">on</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;request&quot;</span><span style="color:#24292E;">, (</span><span style="color:#E36209;">requset</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> {});</span></span></code></pre></div><h3 id="请求上下文如何解析出请求体数据" tabindex="-1">请求上下文如何解析出请求体数据? <a class="header-anchor" href="#请求上下文如何解析出请求体数据" aria-label="Permalink to &quot;请求上下文如何解析出请求体数据?&quot;">​</a></h3><p>一般的网络请求中都会有需要解析出请求体中的数据，进而执行相关业务操作。由于每种请求体格式的解析方法都不太一样，所以我们需要根据请求体类型来执行对应的中间件来解析请求体数据。例如：<code>application/json</code>、 <code>application/x-www-form-urlencoded</code>、<code>multipart/form-data</code> 等等，需要通过不同的中间件来解析不同的数据。需要注意的是，无论那种请求体如何解析，都要注意，他们都是二进制数据。</p><h4 id="接收请求体数据" tabindex="-1">接收请求体数据 <a class="header-anchor" href="#接收请求体数据" aria-label="Permalink to &quot;接收请求体数据&quot;">​</a></h4><p>通常，我们接收请求体的数据都是通过 <code>request.on(&#39;data&#39;,(chunk)=&gt;{})</code> 来监听发送过来的数据片段，每次发送都将数据保存起来，当数据请求完成时会触发<code>end</code>事件,我们可以通过监听 end 事件来告诉程序结束接收数据阶段。<code>request.on(&#39;end&#39;,()=&gt;{})</code>。</p><p>为什么需要通过<strong>request 监听</strong>才能获取数据？因为客户端发送请求，请求中的数据通常是一片段一片段发送过来的，我们需要监听每次发送过来的事件来保存片段，监听 end 事件来结束接收数据，将片段汇聚成完整的请求体数据。<strong>其实 requset 对象是一个 stream</strong>。</p><h4 id="application-json" tabindex="-1">application/json <a class="header-anchor" href="#application-json" aria-label="Permalink to &quot;application/json&quot;">​</a></h4><p>json 格式虽然是二进制数据，但是可以通过 toString 转换成字符串，因为 json 本身就是一个字符串。</p><p>通过监听 request 对象的<code>data</code>事件，可以获取到客户端发送过来的二进制数据片段，我们可以通过一个数组来保存这些二进制片段；当客户端的数据发送完成时，可以通过监听 request 对象的<code>end</code>事件，来结束接收数据。结束后将二进制数据 Buffer 转换成字符串，因为 json 数据本就是字符串，可以将二进制数据转换成字符串,最终再将字符串转换成对象，需要注意，使用 try、catch 来捕获同步的 json 转换错误。</p><p>下列是一个简单示例:</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">server.</span><span style="color:#B392F0;">on</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;request&#39;</span><span style="color:#E1E4E8;">,(</span><span style="color:#FFAB70;">req</span><span style="color:#E1E4E8;">,</span><span style="color:#FFAB70;">res</span><span style="color:#E1E4E8;">)</span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;">{</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">})</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">contentType</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> req.headers[</span><span style="color:#9ECBFF;">&#39;content-type&#39;</span><span style="color:#E1E4E8;">]</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (contentType </span><span style="color:#F97583;">!==</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;application/json&#39;</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#6A737D;">// 非application/json 不解析请求体数据</span></span>
<span class="line"><span style="color:#E1E4E8;">      res.</span><span style="color:#B392F0;">end</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;非json格式的数据&#39;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#F97583;">return</span></span>
<span class="line"><span style="color:#E1E4E8;">    } </span><span style="color:#F97583;">else</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#6A737D;">// 是application/json的请求体类型</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">body</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">await</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">Promise</span><span style="color:#E1E4E8;">(</span><span style="color:#FFAB70;">r</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">jsonBuffer</span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Buffer</span><span style="color:#E1E4E8;">[] </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> []</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#6A737D;">// 为什么要用data、end事件监听和json来累加数据？</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#6A737D;">// 因为请求上传数据不是一瞬间完成的，而是根据网络情况一段一段的流式获取数据的</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#6A737D;">// 每次数据发送过来就会触发data事件，我们可以通过req.on（data）事件来监听每次数据发送到服务器，回调里面接收的参数就是发送过来的请求体数据</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#6A737D;">// 基本上请求体相关的数据都是这样的，流式数据，需要我们一段一段的接收，接收完成后才能做后续处理，比如校验参数，操作db等</span></span>
<span class="line"><span style="color:#E1E4E8;">        req.</span><span style="color:#B392F0;">on</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;data&#39;</span><span style="color:#E1E4E8;">, (</span><span style="color:#FFAB70;">jsonChunk</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">          jsonBuffer.</span><span style="color:#B392F0;">push</span><span style="color:#E1E4E8;">(jsonChunk)</span></span>
<span class="line"><span style="color:#E1E4E8;">        })</span></span>
<span class="line"><span style="color:#E1E4E8;">        req.</span><span style="color:#B392F0;">on</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;end&#39;</span><span style="color:#E1E4E8;">, () </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#6A737D;">// 合并buffer数据</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">buffer</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> Buffer.</span><span style="color:#B392F0;">concat</span><span style="color:#E1E4E8;">(jsonBuffer)</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#F97583;">try</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#6A737D;">// 将buffer数据以utf-8编码格式来转换成字符串</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#B392F0;">r</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">JSON</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">parse</span><span style="color:#E1E4E8;">(buffer.</span><span style="color:#B392F0;">toString</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;utf-8&#39;</span><span style="color:#E1E4E8;">)))</span></span>
<span class="line"><span style="color:#E1E4E8;">          } </span><span style="color:#F97583;">catch</span><span style="color:#E1E4E8;"> (error) {</span></span>
<span class="line"><span style="color:#E1E4E8;">            res.statusCode </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">400</span></span>
<span class="line"><span style="color:#E1E4E8;">            res.</span><span style="color:#B392F0;">end</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;Body type parse in json is error!&#39;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">          }</span></span>
<span class="line"><span style="color:#E1E4E8;">        })</span></span>
<span class="line"><span style="color:#E1E4E8;">      })</span></span>
<span class="line"><span style="color:#E1E4E8;">      res.</span><span style="color:#B392F0;">setHeader</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;content-type&#39;</span><span style="color:#E1E4E8;">,</span><span style="color:#9ECBFF;">&#39;application/json&#39;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">      res.</span><span style="color:#B392F0;">end</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">JSON</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">stringify</span><span style="color:#E1E4E8;">(body))</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">  },</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">server.</span><span style="color:#6F42C1;">on</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;request&#39;</span><span style="color:#24292E;">,(</span><span style="color:#E36209;">req</span><span style="color:#24292E;">,</span><span style="color:#E36209;">res</span><span style="color:#24292E;">)</span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;">{</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">})</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">contentType</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> req.headers[</span><span style="color:#032F62;">&#39;content-type&#39;</span><span style="color:#24292E;">]</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (contentType </span><span style="color:#D73A49;">!==</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;application/json&#39;</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#6A737D;">// 非application/json 不解析请求体数据</span></span>
<span class="line"><span style="color:#24292E;">      res.</span><span style="color:#6F42C1;">end</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;非json格式的数据&#39;</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#D73A49;">return</span></span>
<span class="line"><span style="color:#24292E;">    } </span><span style="color:#D73A49;">else</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#6A737D;">// 是application/json的请求体类型</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">body</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">await</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">Promise</span><span style="color:#24292E;">(</span><span style="color:#E36209;">r</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">jsonBuffer</span><span style="color:#D73A49;">:</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Buffer</span><span style="color:#24292E;">[] </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> []</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6A737D;">// 为什么要用data、end事件监听和json来累加数据？</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6A737D;">// 因为请求上传数据不是一瞬间完成的，而是根据网络情况一段一段的流式获取数据的</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6A737D;">// 每次数据发送过来就会触发data事件，我们可以通过req.on（data）事件来监听每次数据发送到服务器，回调里面接收的参数就是发送过来的请求体数据</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6A737D;">// 基本上请求体相关的数据都是这样的，流式数据，需要我们一段一段的接收，接收完成后才能做后续处理，比如校验参数，操作db等</span></span>
<span class="line"><span style="color:#24292E;">        req.</span><span style="color:#6F42C1;">on</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;data&#39;</span><span style="color:#24292E;">, (</span><span style="color:#E36209;">jsonChunk</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">          jsonBuffer.</span><span style="color:#6F42C1;">push</span><span style="color:#24292E;">(jsonChunk)</span></span>
<span class="line"><span style="color:#24292E;">        })</span></span>
<span class="line"><span style="color:#24292E;">        req.</span><span style="color:#6F42C1;">on</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;end&#39;</span><span style="color:#24292E;">, () </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#6A737D;">// 合并buffer数据</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">buffer</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> Buffer.</span><span style="color:#6F42C1;">concat</span><span style="color:#24292E;">(jsonBuffer)</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#D73A49;">try</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#6A737D;">// 将buffer数据以utf-8编码格式来转换成字符串</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#6F42C1;">r</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">JSON</span><span style="color:#24292E;">.</span><span style="color:#6F42C1;">parse</span><span style="color:#24292E;">(buffer.</span><span style="color:#6F42C1;">toString</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;utf-8&#39;</span><span style="color:#24292E;">)))</span></span>
<span class="line"><span style="color:#24292E;">          } </span><span style="color:#D73A49;">catch</span><span style="color:#24292E;"> (error) {</span></span>
<span class="line"><span style="color:#24292E;">            res.statusCode </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">400</span></span>
<span class="line"><span style="color:#24292E;">            res.</span><span style="color:#6F42C1;">end</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;Body type parse in json is error!&#39;</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">          }</span></span>
<span class="line"><span style="color:#24292E;">        })</span></span>
<span class="line"><span style="color:#24292E;">      })</span></span>
<span class="line"><span style="color:#24292E;">      res.</span><span style="color:#6F42C1;">setHeader</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;content-type&#39;</span><span style="color:#24292E;">,</span><span style="color:#032F62;">&#39;application/json&#39;</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">      res.</span><span style="color:#6F42C1;">end</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">JSON</span><span style="color:#24292E;">.</span><span style="color:#6F42C1;">stringify</span><span style="color:#24292E;">(body))</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"><span style="color:#24292E;">  },</span></span></code></pre></div><h4 id="multipary-form-data" tabindex="-1">multipary/form-data <a class="header-anchor" href="#multipary-form-data" aria-label="Permalink to &quot;multipary/form-data&quot;">​</a></h4><p>这个是最难的，因为每次发送请求时都需要携带一个独一无二的分隔符（代表了请求体中某两个字段之间的分隔符），我们需要在请求头部中找到这个分隔符，在将这个二进制数据转换成字符串，通过分隔符将字符串切割成键值对的对象。 // 未完成...</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;">// multipart/form-data</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">async</span><span style="color:#E1E4E8;"> (</span><span style="color:#FFAB70;">req</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">res</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">next</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (req.method?.</span><span style="color:#B392F0;">toUpperCase</span><span style="color:#E1E4E8;">() </span><span style="color:#F97583;">===</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;GET&#39;</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#6A737D;">// 无请求体的方法不需要解析</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#B392F0;">next</span><span style="color:#E1E4E8;">()</span></span>
<span class="line"><span style="color:#E1E4E8;">    } </span><span style="color:#F97583;">else</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">contentType</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> req.headers[</span><span style="color:#9ECBFF;">&#39;content-type&#39;</span><span style="color:#E1E4E8;">]</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (contentType </span><span style="color:#F97583;">===</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">undefined</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#6A737D;">// 未携带请求体类型，不解析</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#B392F0;">next</span><span style="color:#E1E4E8;">()</span></span>
<span class="line"><span style="color:#E1E4E8;">      } </span><span style="color:#F97583;">else</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> [</span><span style="color:#79B8FF;">_contentType</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">_boundary</span><span style="color:#E1E4E8;">] </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> contentType.</span><span style="color:#B392F0;">split</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;; &#39;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (_contentType </span><span style="color:#F97583;">===</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;multipart/form-data&#39;</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">data</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">await</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">Promise</span><span style="color:#E1E4E8;">&lt;</span><span style="color:#B392F0;">Buffer</span><span style="color:#E1E4E8;">&gt;(</span><span style="color:#FFAB70;">r</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">buffer</span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Buffer</span><span style="color:#E1E4E8;">[] </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> []</span></span>
<span class="line"><span style="color:#E1E4E8;">            req.</span><span style="color:#B392F0;">on</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;data&#39;</span><span style="color:#E1E4E8;">, (</span><span style="color:#FFAB70;">chuck</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">              buffer.</span><span style="color:#B392F0;">push</span><span style="color:#E1E4E8;">(chuck)</span></span>
<span class="line"><span style="color:#E1E4E8;">            })</span></span>
<span class="line"><span style="color:#E1E4E8;">            req.</span><span style="color:#B392F0;">on</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;end&#39;</span><span style="color:#E1E4E8;">, () </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">              </span><span style="color:#B392F0;">r</span><span style="color:#E1E4E8;">(Buffer.</span><span style="color:#B392F0;">concat</span><span style="color:#E1E4E8;">(buffer))</span></span>
<span class="line"><span style="color:#E1E4E8;">            })</span></span>
<span class="line"><span style="color:#E1E4E8;">          })</span></span>
<span class="line"><span style="color:#E1E4E8;">          console.</span><span style="color:#B392F0;">log</span><span style="color:#E1E4E8;">(data);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#B392F0;">next</span><span style="color:#E1E4E8;">()</span></span>
<span class="line"><span style="color:#E1E4E8;">        } </span><span style="color:#F97583;">else</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#6A737D;">// 非multipary，不解析</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#B392F0;">next</span><span style="color:#E1E4E8;">()</span></span>
<span class="line"><span style="color:#E1E4E8;">        }</span></span>
<span class="line"><span style="color:#E1E4E8;">      }</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">  },</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">  </span><span style="color:#6A737D;">// multipart/form-data</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">async</span><span style="color:#24292E;"> (</span><span style="color:#E36209;">req</span><span style="color:#24292E;">, </span><span style="color:#E36209;">res</span><span style="color:#24292E;">, </span><span style="color:#E36209;">next</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (req.method?.</span><span style="color:#6F42C1;">toUpperCase</span><span style="color:#24292E;">() </span><span style="color:#D73A49;">===</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;GET&#39;</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#6A737D;">// 无请求体的方法不需要解析</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#6F42C1;">next</span><span style="color:#24292E;">()</span></span>
<span class="line"><span style="color:#24292E;">    } </span><span style="color:#D73A49;">else</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">contentType</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> req.headers[</span><span style="color:#032F62;">&#39;content-type&#39;</span><span style="color:#24292E;">]</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (contentType </span><span style="color:#D73A49;">===</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">undefined</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6A737D;">// 未携带请求体类型，不解析</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6F42C1;">next</span><span style="color:#24292E;">()</span></span>
<span class="line"><span style="color:#24292E;">      } </span><span style="color:#D73A49;">else</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">const</span><span style="color:#24292E;"> [</span><span style="color:#005CC5;">_contentType</span><span style="color:#24292E;">, </span><span style="color:#005CC5;">_boundary</span><span style="color:#24292E;">] </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> contentType.</span><span style="color:#6F42C1;">split</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;; &#39;</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (_contentType </span><span style="color:#D73A49;">===</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;multipart/form-data&#39;</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">data</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">await</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">Promise</span><span style="color:#24292E;">&lt;</span><span style="color:#6F42C1;">Buffer</span><span style="color:#24292E;">&gt;(</span><span style="color:#E36209;">r</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">buffer</span><span style="color:#D73A49;">:</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Buffer</span><span style="color:#24292E;">[] </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> []</span></span>
<span class="line"><span style="color:#24292E;">            req.</span><span style="color:#6F42C1;">on</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;data&#39;</span><span style="color:#24292E;">, (</span><span style="color:#E36209;">chuck</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">              buffer.</span><span style="color:#6F42C1;">push</span><span style="color:#24292E;">(chuck)</span></span>
<span class="line"><span style="color:#24292E;">            })</span></span>
<span class="line"><span style="color:#24292E;">            req.</span><span style="color:#6F42C1;">on</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;end&#39;</span><span style="color:#24292E;">, () </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">              </span><span style="color:#6F42C1;">r</span><span style="color:#24292E;">(Buffer.</span><span style="color:#6F42C1;">concat</span><span style="color:#24292E;">(buffer))</span></span>
<span class="line"><span style="color:#24292E;">            })</span></span>
<span class="line"><span style="color:#24292E;">          })</span></span>
<span class="line"><span style="color:#24292E;">          console.</span><span style="color:#6F42C1;">log</span><span style="color:#24292E;">(data);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#6F42C1;">next</span><span style="color:#24292E;">()</span></span>
<span class="line"><span style="color:#24292E;">        } </span><span style="color:#D73A49;">else</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#6A737D;">// 非multipary，不解析</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#6F42C1;">next</span><span style="color:#24292E;">()</span></span>
<span class="line"><span style="color:#24292E;">        }</span></span>
<span class="line"><span style="color:#24292E;">      }</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"><span style="color:#24292E;">  },</span></span></code></pre></div><h4 id="application-x-www-form-urlencoded" tabindex="-1">application/x-www-form-urlencoded <a class="header-anchor" href="#application-x-www-form-urlencoded" aria-label="Permalink to &quot;application/x-www-form-urlencoded&quot;">​</a></h4><p>这个相对比较容易，因为该类型的请求体实际上就是一个字符串，我们只需要将其解析成对象即可，获取数据的方式也是一样的，通过监听请求对象的 data 事件获取片段数据，监听请求对象的 end 事件来结束接收请求体，合并数据。</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;">// x-www-form-urlencoded</span></span>
<span class="line"><span style="color:#E1E4E8;">  server.</span><span style="color:#B392F0;">on</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;request&#39;</span><span style="color:#E1E4E8;">,(</span><span style="color:#FFAB70;">req</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">res</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">next</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (req.method?.</span><span style="color:#B392F0;">toUpperCase</span><span style="color:#E1E4E8;">() </span><span style="color:#F97583;">===</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;GET&#39;</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#6A737D;">// 非能携带请求体的请求绕过解析</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#6A737D;">// next()</span></span>
<span class="line"><span style="color:#E1E4E8;">    } </span><span style="color:#F97583;">else</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (req.headers[</span><span style="color:#9ECBFF;">&#39;content-type&#39;</span><span style="color:#E1E4E8;">] </span><span style="color:#F97583;">===</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;application/x-www-form-urlencoded&#39;</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">data</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">await</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">Promise</span><span style="color:#E1E4E8;">&lt;</span><span style="color:#B392F0;">Buffer</span><span style="color:#E1E4E8;">&gt;(</span><span style="color:#FFAB70;">r</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">buffer</span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Buffer</span><span style="color:#E1E4E8;">[] </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> []</span></span>
<span class="line"><span style="color:#E1E4E8;">        req.</span><span style="color:#B392F0;">on</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;data&#39;</span><span style="color:#E1E4E8;">, (</span><span style="color:#FFAB70;">chuck</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">          buffer.</span><span style="color:#B392F0;">push</span><span style="color:#E1E4E8;">(chuck)</span></span>
<span class="line"><span style="color:#E1E4E8;">        })</span></span>
<span class="line"><span style="color:#E1E4E8;">        req.</span><span style="color:#B392F0;">on</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;end&#39;</span><span style="color:#E1E4E8;">, () </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#B392F0;">r</span><span style="color:#E1E4E8;">(Buffer.</span><span style="color:#B392F0;">concat</span><span style="color:#E1E4E8;">(buffer))</span></span>
<span class="line"><span style="color:#E1E4E8;">        })</span></span>
<span class="line"><span style="color:#E1E4E8;">      })</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#6A737D;">// 解析数据</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">body</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> data.</span><span style="color:#B392F0;">toString</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;utf-8&#39;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">        .</span><span style="color:#B392F0;">split</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;&amp;&#39;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">        .</span><span style="color:#B392F0;">filter</span><span style="color:#E1E4E8;">(</span><span style="color:#FFAB70;">ele</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> ele)</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#6A737D;">// @ts-ignore</span></span>
<span class="line"><span style="color:#E1E4E8;">        .</span><span style="color:#B392F0;">reduce</span><span style="color:#E1E4E8;">((</span><span style="color:#FFAB70;">pre</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">ele</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> [</span><span style="color:#79B8FF;">key</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">value</span><span style="color:#E1E4E8;">] </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> ele.</span><span style="color:#B392F0;">split</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;=&#39;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#F97583;">...</span><span style="color:#E1E4E8;">pre,</span></span>
<span class="line"><span style="color:#E1E4E8;">            [key]: value,</span></span>
<span class="line"><span style="color:#E1E4E8;">          }</span></span>
<span class="line"><span style="color:#E1E4E8;">        }, {});</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#6A737D;">// @ts-ignore</span></span>
<span class="line"><span style="color:#E1E4E8;">      req.body</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">body</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#6A737D;">// next()</span></span>
<span class="line"><span style="color:#E1E4E8;">    } </span><span style="color:#F97583;">else</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#6A737D;">//  非 x-www-form-urlencoded 请求体类型绕过解析</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#6A737D;">// next()</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">  }),</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">  </span><span style="color:#6A737D;">// x-www-form-urlencoded</span></span>
<span class="line"><span style="color:#24292E;">  server.</span><span style="color:#6F42C1;">on</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;request&#39;</span><span style="color:#24292E;">,(</span><span style="color:#E36209;">req</span><span style="color:#24292E;">, </span><span style="color:#E36209;">res</span><span style="color:#24292E;">, </span><span style="color:#E36209;">next</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (req.method?.</span><span style="color:#6F42C1;">toUpperCase</span><span style="color:#24292E;">() </span><span style="color:#D73A49;">===</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;GET&#39;</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#6A737D;">// 非能携带请求体的请求绕过解析</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#6A737D;">// next()</span></span>
<span class="line"><span style="color:#24292E;">    } </span><span style="color:#D73A49;">else</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (req.headers[</span><span style="color:#032F62;">&#39;content-type&#39;</span><span style="color:#24292E;">] </span><span style="color:#D73A49;">===</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;application/x-www-form-urlencoded&#39;</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">data</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">await</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">Promise</span><span style="color:#24292E;">&lt;</span><span style="color:#6F42C1;">Buffer</span><span style="color:#24292E;">&gt;(</span><span style="color:#E36209;">r</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">buffer</span><span style="color:#D73A49;">:</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Buffer</span><span style="color:#24292E;">[] </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> []</span></span>
<span class="line"><span style="color:#24292E;">        req.</span><span style="color:#6F42C1;">on</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;data&#39;</span><span style="color:#24292E;">, (</span><span style="color:#E36209;">chuck</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">          buffer.</span><span style="color:#6F42C1;">push</span><span style="color:#24292E;">(chuck)</span></span>
<span class="line"><span style="color:#24292E;">        })</span></span>
<span class="line"><span style="color:#24292E;">        req.</span><span style="color:#6F42C1;">on</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;end&#39;</span><span style="color:#24292E;">, () </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#6F42C1;">r</span><span style="color:#24292E;">(Buffer.</span><span style="color:#6F42C1;">concat</span><span style="color:#24292E;">(buffer))</span></span>
<span class="line"><span style="color:#24292E;">        })</span></span>
<span class="line"><span style="color:#24292E;">      })</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#6A737D;">// 解析数据</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">body</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> data.</span><span style="color:#6F42C1;">toString</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;utf-8&#39;</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">        .</span><span style="color:#6F42C1;">split</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;&amp;&#39;</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">        .</span><span style="color:#6F42C1;">filter</span><span style="color:#24292E;">(</span><span style="color:#E36209;">ele</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> ele)</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6A737D;">// @ts-ignore</span></span>
<span class="line"><span style="color:#24292E;">        .</span><span style="color:#6F42C1;">reduce</span><span style="color:#24292E;">((</span><span style="color:#E36209;">pre</span><span style="color:#24292E;">, </span><span style="color:#E36209;">ele</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#D73A49;">const</span><span style="color:#24292E;"> [</span><span style="color:#005CC5;">key</span><span style="color:#24292E;">, </span><span style="color:#005CC5;">value</span><span style="color:#24292E;">] </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> ele.</span><span style="color:#6F42C1;">split</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;=&#39;</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#D73A49;">...</span><span style="color:#24292E;">pre,</span></span>
<span class="line"><span style="color:#24292E;">            [key]: value,</span></span>
<span class="line"><span style="color:#24292E;">          }</span></span>
<span class="line"><span style="color:#24292E;">        }, {});</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#6A737D;">// @ts-ignore</span></span>
<span class="line"><span style="color:#24292E;">      req.body</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">body</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#6A737D;">// next()</span></span>
<span class="line"><span style="color:#24292E;">    } </span><span style="color:#D73A49;">else</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#6A737D;">//  非 x-www-form-urlencoded 请求体类型绕过解析</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#6A737D;">// next()</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"><span style="color:#24292E;">  }),</span></span></code></pre></div><h2 id="响应上下文" tabindex="-1">响应上下文 <a class="header-anchor" href="#响应上下文" aria-label="Permalink to &quot;响应上下文&quot;">​</a></h2><h3 id="分块传输" tabindex="-1">分块传输 <a class="header-anchor" href="#分块传输" aria-label="Permalink to &quot;分块传输&quot;">​</a></h3><p><a href="https://segmentfault.com/a/1190000016704648" target="_blank" rel="noreferrer">https://segmentfault.com/a/1190000016704648</a></p><h1 id="fs-模块" tabindex="-1">fs 模块 <a class="header-anchor" href="#fs-模块" aria-label="Permalink to &quot;fs 模块&quot;">​</a></h1><h2 id="一、文件常识" tabindex="-1">一、文件常识 <a class="header-anchor" href="#一、文件常识" aria-label="Permalink to &quot;一、文件常识&quot;">​</a></h2><p>计算机中的一些文件知识，文件的权限位 mode、标识位 flag、文件描述符 fd 。node 中的 fs 模块与文件操作密切，这些是必须要了解的。</p><h3 id="_1-权限位-mode" tabindex="-1">1.权限位 mode <a class="header-anchor" href="#_1-权限位-mode" aria-label="Permalink to &quot;1.权限位 mode&quot;">​</a></h3><p>因为 fs 模块需要对文件进行操作，会涉及到操作权限的问题，所以需要先清楚文件权限是什么，都有哪些权限。</p><p>文件权限表：</p><p><img src="http://img.inode.club/modules_fs_01.jpg" alt="img"></p><p>在上面表格中，我们可以看出系统中针对三种类型进行权限分配，即文件所有者（自己）、文件所属组（家人）和其他用户（陌生人），文件操作权限又分为三种，读、写和执行，数字表示为八进制数，具备权限的八进制数分别为 <code>4</code>、<code>2</code>、<code>1</code>，不具备权限为 0。</p><p>为了更容易理解，我们可以随便在一个目录中打开 <code>Git</code>，使用 <code>Linux</code> 命令 <code>ls -al</code> 来查目录中文件和文件夹的权限位</p><div class="language-text vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">text</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">drwxr-xr-x 1 koala 197121 0 Jun 28 14:41 core</span></span>
<span class="line"><span style="color:#e1e4e8;">-rw-r--r-- 1 koala 197121 293 Jun 23 17:44 index.md</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">drwxr-xr-x 1 koala 197121 0 Jun 28 14:41 core</span></span>
<span class="line"><span style="color:#24292e;">-rw-r--r-- 1 koala 197121 293 Jun 23 17:44 index.md</span></span></code></pre></div><p>在上面的目录信息当中，很容易看出用户名、创建时间和文件名等信息，但最重要的是开头第一项（十位的字符）。</p><p><strong>文件权限信息</strong></p><p>文件权限信息由十位数字组成：包括了该文件是否是文件夹（1 位）、文件所有者权限（3 位）、用户组权限（3 位）、其他人的权限（3 位）。</p><p>第一位代表是文件还是文件夹，<code>d</code> 开头代表文件夹，<code>-</code> 开头的代表文件，而后面九位就代表当前用户、用户所属组和其他用户的权限位，按每三位划分，分别代表读（r）、写（w）和执行（x），<code>-</code> 代表没有当前位对应的权限。</p><p>例如:<code>drwxr-xr-x</code></p><p>第一位：d 表示了是文件</p><p>第 2 位-第 4 位（文件拥有者的权限）：rwx，拥有读、写、执行权限</p><p>第 5 位-第 7 位 （文件所属组的权限）：r-x，拥有读、执行的权限</p><p>第 8 位-第 10 位 （其他用户的权限）：r-w，拥有读、执行的权限</p><blockquote><p>权限参数 mode 主要针对 Linux 和 Unix 操作系统，Window 的权限默认是可读、可写、不可执行，所以权限位数字表示为 0o666，转换十进制表示为 438。</p></blockquote><p><img src="http://img.inode.club/modules_fs_02.jpg" alt="img"></p><h3 id="custom-id" tabindex="-1">2.标识位 flag <a class="header-anchor" href="#custom-id" aria-label="Permalink to &quot;2.标识位 flag {#custom-id}&quot;">​</a></h3><p>Node.js 中，标识位代表着对文件的操作方式，如可读、可写、即可读又可写等等，在下面用一张表来表示文件操作的标识位和其对应的含义。</p><table><thead><tr><th>符号</th><th>含义</th></tr></thead><tbody><tr><td>r</td><td>读取文件，如果文件不存在则抛出异常。</td></tr><tr><td>r+</td><td>读取并写入文件，如果文件不存在则抛出异常。</td></tr><tr><td>rs</td><td>读取并写入文件，指示操作系统绕开本地文件系统缓存。</td></tr><tr><td>w</td><td>写入文件，文件不存在会被创建，存在则清空后写入。</td></tr><tr><td>wx</td><td>写入文件，排它方式打开。</td></tr><tr><td>w+</td><td>读取并写入文件，文件不存在则创建文件，存在则清空后写入。</td></tr><tr><td>wx+</td><td>和 w+ 类似，排他方式打开。</td></tr><tr><td>a</td><td>追加写入，文件不存在则创建文件。</td></tr><tr><td>ax</td><td>与 a 类似，排他方式打开。</td></tr><tr><td>a+</td><td>读取并追加写入，不存在则创建。</td></tr><tr><td>ax+</td><td>与 a+ 类似，排他方式打开。</td></tr></tbody></table><p>上面表格就是这些标识位的具体字符和含义，但是 flag 是不经常使用的，不容易被记住，所以在下面总结了一个加速记忆的方法。</p><ul><li>r：读取</li><li>w：写入</li><li>s：同步</li><li>+：增加相反操作</li><li>x：排他方式</li></ul><blockquote><p>r+ 和 w+ 的区别，当文件不存在时，r+ 不会创建文件，而会抛出异常，但 w+ 会创建文件；如果文件存在，r+ 不会自动清空文件，但 w+ 会自动把已有文件的内容清空。</p></blockquote><h3 id="_3-文件描述符-fs" tabindex="-1">3.文件描述符 fs <a class="header-anchor" href="#_3-文件描述符-fs" aria-label="Permalink to &quot;3.文件描述符 fs&quot;">​</a></h3><blockquote><p>操作系统会为每个打开的文件分配一个名为文件描述符的数值标识，文件操作使用这些文件描述符来识别与追踪每个特定的文件，Window 系统使用了一个不同但概念类似的机制来追踪资源，为方便用户，NodeJS 抽象了不同操作系统间的差异，为所有打开的文件分配了数值的文件描述符。</p></blockquote><p>在 Node.js 中，每操作一个文件，文件描述符是递增的，文件描述符一般从 3 开始，因为前面有 0、1、2 三个比较特殊的描述符，分别代表 <code>process.stdin</code>（标准输入）、<code>process.stdout</code>（标准输出）和 <code>process.stderr</code>（错误输出）。</p><h2 id="二、完整性读取文件" tabindex="-1">二、完整性读取文件 <a class="header-anchor" href="#二、完整性读取文件" aria-label="Permalink to &quot;二、完整性读取文件&quot;">​</a></h2><p>下列操作都会直接将文件读取到内存中进行操作，使用时注意内存开销。fs 的模块同一种方法一般都有两套 API，一种是同步的 Sync 后缀，一种是异步的，需要传递回调。</p><h3 id="_1-readfile、readfilesync-文件读取函数" tabindex="-1">1.readFile、readFIleSync 文件读取函数 <a class="header-anchor" href="#_1-readfile、readfilesync-文件读取函数" aria-label="Permalink to &quot;1.readFile、readFIleSync 文件读取函数&quot;">​</a></h3><h4 id="readfile" tabindex="-1">readFile <a class="header-anchor" href="#readfile" aria-label="Permalink to &quot;readFile&quot;">​</a></h4><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">fs.readFile(filename,[encoding],[callback(error,data)]</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">fs.readFile(filename,[encoding],[callback(error,data)]</span></span></code></pre></div><ol><li><p>它接收第一个必选参数 filename，表示读取的文件名。</p></li><li><p>第二个参数 encoding 是可选的，表示文件字符编码，例如&#39;utf-8&#39;。第二个参数也可以是配置项，可以配置以何种方式打开文件：</p><p><code>encoding</code>：以何种编码打开文件</p><p><code>flag</code>：以何种标识位<a href="#custom-id">标识位</a>打开文件，默认<code>r</code></p><p><code>signal</code> 允许中止正在进行的读取文件</p></li><li><p>第三个参数<code>callback</code>是回调函数，用于接收文件的内容。 说明：如果不指定 encoding ，则<code>callback</code>就是第二个参数。 回调函数提供两个参数 err 和 data ， err 表示有没有错误发生，data 是文件内容。</p></li><li><p>如果指定了 encoding ， data 是一个解析后的字符串，否则将会以 <strong>Buffer</strong> 形式表示的二进制数据。</p></li></ol><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">readFile</span><span style="color:#E1E4E8;">(</span><span style="color:#B392F0;">getFilePath</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;./01.txt&quot;</span><span style="color:#E1E4E8;">), { encoding: </span><span style="color:#9ECBFF;">&quot;utf-8&quot;</span><span style="color:#E1E4E8;"> }, (</span><span style="color:#FFAB70;">err</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">data</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (err) {</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">throw</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Error</span><span style="color:#E1E4E8;">(err);</span></span>
<span class="line"><span style="color:#E1E4E8;">  }</span></span>
<span class="line"><span style="color:#E1E4E8;">  console.</span><span style="color:#B392F0;">log</span><span style="color:#E1E4E8;">(data);</span></span>
<span class="line"><span style="color:#E1E4E8;">});</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">readFile</span><span style="color:#24292E;">(</span><span style="color:#6F42C1;">getFilePath</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;./01.txt&quot;</span><span style="color:#24292E;">), { encoding: </span><span style="color:#032F62;">&quot;utf-8&quot;</span><span style="color:#24292E;"> }, (</span><span style="color:#E36209;">err</span><span style="color:#24292E;">, </span><span style="color:#E36209;">data</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (err) {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">throw</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Error</span><span style="color:#24292E;">(err);</span></span>
<span class="line"><span style="color:#24292E;">  }</span></span>
<span class="line"><span style="color:#24292E;">  console.</span><span style="color:#6F42C1;">log</span><span style="color:#24292E;">(data);</span></span>
<span class="line"><span style="color:#24292E;">});</span></span></code></pre></div><h4 id="readfilesync" tabindex="-1">readFIleSync <a class="header-anchor" href="#readfilesync" aria-label="Permalink to &quot;readFIleSync&quot;">​</a></h4><p>​ readFIleSync 是 readFile 的另一种调用方式，readFile 是异步的，readFileSync 是同步的，就意味着读取文件会阻塞后续代码的执行。参数和 readFile 少一个回调。</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">fs.</span><span style="color:#B392F0;">readFileSync</span><span style="color:#E1E4E8;">(filename, [options]);</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">fs.</span><span style="color:#6F42C1;">readFileSync</span><span style="color:#24292E;">(filename, [options]);</span></span></code></pre></div><h3 id="_2-writefile、writefilesync-写入文件" tabindex="-1">2.writeFile、writeFileSync 写入文件 <a class="header-anchor" href="#_2-writefile、writefilesync-写入文件" aria-label="Permalink to &quot;2.writeFile、writeFileSync 写入文件&quot;">​</a></h3><h4 id="writefile" tabindex="-1">writeFile <a class="header-anchor" href="#writefile" aria-label="Permalink to &quot;writeFile&quot;">​</a></h4><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">fs.</span><span style="color:#B392F0;">writeFile</span><span style="color:#E1E4E8;">(path, data, options, callback);</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">fs.</span><span style="color:#6F42C1;">writeFile</span><span style="color:#24292E;">(path, data, options, callback);</span></span></code></pre></div><p>path：写入文件的路径</p><p>data：写入的内容</p><p>options：写入的方式</p><blockquote><p>​ encoding：以什么编码写入内容</p><p>​ mode：新文件的权限，默认 0x666，所有人的权限都是读写执行</p><p>​ flag：写入文件的方式，默认<code>w</code>，会清空文件并写入内容。</p></blockquote><p>callback：结果回调</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">fs.</span><span style="color:#B392F0;">writeFile</span><span style="color:#E1E4E8;">(</span></span>
<span class="line"><span style="color:#E1E4E8;">  path.</span><span style="color:#B392F0;">resolve</span><span style="color:#E1E4E8;">(rootPath, </span><span style="color:#9ECBFF;">&quot;./01.txt&quot;</span><span style="color:#E1E4E8;">),</span></span>
<span class="line"><span style="color:#E1E4E8;">  Buffer.</span><span style="color:#B392F0;">from</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;爱你!&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&quot;utf-8&quot;</span><span style="color:#E1E4E8;">), </span><span style="color:#6A737D;">// 将爱你字符串转换成utf-8编码格式的二进制数据</span></span>
<span class="line"><span style="color:#E1E4E8;">  {</span></span>
<span class="line"><span style="color:#E1E4E8;">    flag: </span><span style="color:#9ECBFF;">&quot;a&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#6A737D;">// 追加文件</span></span>
<span class="line"><span style="color:#E1E4E8;">  },</span></span>
<span class="line"><span style="color:#E1E4E8;">  (</span><span style="color:#FFAB70;">err</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (err) </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> console.</span><span style="color:#B392F0;">log</span><span style="color:#E1E4E8;">(err);</span></span>
<span class="line"><span style="color:#E1E4E8;">  }</span></span>
<span class="line"><span style="color:#E1E4E8;">);</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">fs.</span><span style="color:#6F42C1;">writeFile</span><span style="color:#24292E;">(</span></span>
<span class="line"><span style="color:#24292E;">  path.</span><span style="color:#6F42C1;">resolve</span><span style="color:#24292E;">(rootPath, </span><span style="color:#032F62;">&quot;./01.txt&quot;</span><span style="color:#24292E;">),</span></span>
<span class="line"><span style="color:#24292E;">  Buffer.</span><span style="color:#6F42C1;">from</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;爱你!&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;utf-8&quot;</span><span style="color:#24292E;">), </span><span style="color:#6A737D;">// 将爱你字符串转换成utf-8编码格式的二进制数据</span></span>
<span class="line"><span style="color:#24292E;">  {</span></span>
<span class="line"><span style="color:#24292E;">    flag: </span><span style="color:#032F62;">&quot;a&quot;</span><span style="color:#24292E;">, </span><span style="color:#6A737D;">// 追加文件</span></span>
<span class="line"><span style="color:#24292E;">  },</span></span>
<span class="line"><span style="color:#24292E;">  (</span><span style="color:#E36209;">err</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (err) </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> console.</span><span style="color:#6F42C1;">log</span><span style="color:#24292E;">(err);</span></span>
<span class="line"><span style="color:#24292E;">  }</span></span>
<span class="line"><span style="color:#24292E;">);</span></span></code></pre></div><h4 id="writefilesync" tabindex="-1">writeFileSync <a class="header-anchor" href="#writefilesync" aria-label="Permalink to &quot;writeFileSync&quot;">​</a></h4><p>​ writeFile 的同步版本，参数差不多，没有返回值</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">fs.</span><span style="color:#B392F0;">writeFileSync</span><span style="color:#E1E4E8;">(path.</span><span style="color:#B392F0;">resolve</span><span style="color:#E1E4E8;">(rootPath, </span><span style="color:#9ECBFF;">&quot;./01.txt&quot;</span><span style="color:#E1E4E8;">), </span><span style="color:#9ECBFF;">&quot;爱你哟!&quot;</span><span style="color:#E1E4E8;">, {</span></span>
<span class="line"><span style="color:#E1E4E8;">  flag: </span><span style="color:#9ECBFF;">&quot;w&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">});</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">fs.</span><span style="color:#6F42C1;">writeFileSync</span><span style="color:#24292E;">(path.</span><span style="color:#6F42C1;">resolve</span><span style="color:#24292E;">(rootPath, </span><span style="color:#032F62;">&quot;./01.txt&quot;</span><span style="color:#24292E;">), </span><span style="color:#032F62;">&quot;爱你哟!&quot;</span><span style="color:#24292E;">, {</span></span>
<span class="line"><span style="color:#24292E;">  flag: </span><span style="color:#032F62;">&quot;w&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">});</span></span></code></pre></div><h3 id="_3-appendfile、appendfilesync-追加文件" tabindex="-1">3.appendFile、appendFileSync 追加文件 <a class="header-anchor" href="#_3-appendfile、appendfilesync-追加文件" aria-label="Permalink to &quot;3.appendFile、appendFileSync 追加文件&quot;">​</a></h3><p>​ <code>appendFile</code>和<code>writeFile</code>功能差不多，只不过<code>options</code>中的文件标识<code>flag</code>默认为<code>a</code></p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">fs.</span><span style="color:#B392F0;">appendFile</span><span style="color:#E1E4E8;">(path, data, options, callback);</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">fs.</span><span style="color:#6F42C1;">appendFile</span><span style="color:#24292E;">(path, data, options, callback);</span></span></code></pre></div><p>注意 options 中的 flag 是可以修改的。</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">fs.</span><span style="color:#B392F0;">appendFile</span><span style="color:#E1E4E8;">(</span></span>
<span class="line"><span style="color:#E1E4E8;">  path.</span><span style="color:#B392F0;">resolve</span><span style="color:#E1E4E8;">(rootPath, </span><span style="color:#9ECBFF;">&quot;./01.txt&quot;</span><span style="color:#E1E4E8;">),</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">&quot;彻底疯狂!!&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">  { flag: </span><span style="color:#9ECBFF;">&quot;w&quot;</span><span style="color:#E1E4E8;"> }, </span><span style="color:#6A737D;">// flag默认为 &#39;a&#39;</span></span>
<span class="line"><span style="color:#E1E4E8;">  (</span><span style="color:#FFAB70;">err</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">    console.</span><span style="color:#B392F0;">log</span><span style="color:#E1E4E8;">(err);</span></span>
<span class="line"><span style="color:#E1E4E8;">  }</span></span>
<span class="line"><span style="color:#E1E4E8;">);</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">fs.</span><span style="color:#6F42C1;">appendFile</span><span style="color:#24292E;">(</span></span>
<span class="line"><span style="color:#24292E;">  path.</span><span style="color:#6F42C1;">resolve</span><span style="color:#24292E;">(rootPath, </span><span style="color:#032F62;">&quot;./01.txt&quot;</span><span style="color:#24292E;">),</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#032F62;">&quot;彻底疯狂!!&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">  { flag: </span><span style="color:#032F62;">&quot;w&quot;</span><span style="color:#24292E;"> }, </span><span style="color:#6A737D;">// flag默认为 &#39;a&#39;</span></span>
<span class="line"><span style="color:#24292E;">  (</span><span style="color:#E36209;">err</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">    console.</span><span style="color:#6F42C1;">log</span><span style="color:#24292E;">(err);</span></span>
<span class="line"><span style="color:#24292E;">  }</span></span>
<span class="line"><span style="color:#24292E;">);</span></span></code></pre></div><h3 id="_4-copyfile、copyfilesync-拷贝文件" tabindex="-1">4.copyFile、copyFileSync 拷贝文件 <a class="header-anchor" href="#_4-copyfile、copyfilesync-拷贝文件" aria-label="Permalink to &quot;4.copyFile、copyFileSync 拷贝文件&quot;">​</a></h3><p>copyFile 可以将源文件拷贝到目的路径中。</p><p><code>dest</code>路径目录必须存在，文件可存在可不存在，若存在则会被覆盖，不存在则会新创建。</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">// copyFile</span></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">fs</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">require</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;fs&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">path</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">require</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;path&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">rootPath</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> path.</span><span style="color:#B392F0;">resolve</span><span style="color:#E1E4E8;">(__dirname, </span><span style="color:#9ECBFF;">&quot;../test&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">fs.</span><span style="color:#B392F0;">copyFile</span><span style="color:#E1E4E8;">(</span></span>
<span class="line"><span style="color:#E1E4E8;">  path.</span><span style="color:#B392F0;">resolve</span><span style="color:#E1E4E8;">(rootPath, </span><span style="color:#9ECBFF;">&quot;./01.txt&quot;</span><span style="color:#E1E4E8;">), </span><span style="color:#6A737D;">// src</span></span>
<span class="line"><span style="color:#E1E4E8;">  path.</span><span style="color:#B392F0;">resolve</span><span style="color:#E1E4E8;">(rootPath, </span><span style="color:#9ECBFF;">&quot;./02.txt&quot;</span><span style="color:#E1E4E8;">), </span><span style="color:#6A737D;">// dest</span></span>
<span class="line"><span style="color:#E1E4E8;">  (</span><span style="color:#FFAB70;">err</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (err) {</span></span>
<span class="line"><span style="color:#E1E4E8;">      console.</span><span style="color:#B392F0;">log</span><span style="color:#E1E4E8;">(err);</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">  }</span></span>
<span class="line"><span style="color:#E1E4E8;">);</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">// copyFile</span></span>
<span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">fs</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">require</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;fs&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">path</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">require</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;path&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">rootPath</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> path.</span><span style="color:#6F42C1;">resolve</span><span style="color:#24292E;">(__dirname, </span><span style="color:#032F62;">&quot;../test&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">fs.</span><span style="color:#6F42C1;">copyFile</span><span style="color:#24292E;">(</span></span>
<span class="line"><span style="color:#24292E;">  path.</span><span style="color:#6F42C1;">resolve</span><span style="color:#24292E;">(rootPath, </span><span style="color:#032F62;">&quot;./01.txt&quot;</span><span style="color:#24292E;">), </span><span style="color:#6A737D;">// src</span></span>
<span class="line"><span style="color:#24292E;">  path.</span><span style="color:#6F42C1;">resolve</span><span style="color:#24292E;">(rootPath, </span><span style="color:#032F62;">&quot;./02.txt&quot;</span><span style="color:#24292E;">), </span><span style="color:#6A737D;">// dest</span></span>
<span class="line"><span style="color:#24292E;">  (</span><span style="color:#E36209;">err</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (err) {</span></span>
<span class="line"><span style="color:#24292E;">      console.</span><span style="color:#6F42C1;">log</span><span style="color:#24292E;">(err);</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"><span style="color:#24292E;">  }</span></span>
<span class="line"><span style="color:#24292E;">);</span></span></code></pre></div><h3 id="_5-unlink、unlinksync-删除文件" tabindex="-1">5.unlink、unlinkSync 删除文件 <a class="header-anchor" href="#_5-unlink、unlinksync-删除文件" aria-label="Permalink to &quot;5.unlink、unlinkSync 删除文件&quot;">​</a></h3><p>unlink 可以将目标文件删除。</p><div class="language-json vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">fs.unlink(path,callback)</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">fs.unlink(path,callback)</span></span></code></pre></div><p>例：</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">// unlink</span></span>
<span class="line"><span style="color:#E1E4E8;">fs.</span><span style="color:#B392F0;">unlink</span><span style="color:#E1E4E8;">(path.</span><span style="color:#B392F0;">resolve</span><span style="color:#E1E4E8;">(rootPath, </span><span style="color:#9ECBFF;">&quot;./02.txt&quot;</span><span style="color:#E1E4E8;">), (</span><span style="color:#FFAB70;">err</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (err) </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> console.</span><span style="color:#B392F0;">log</span><span style="color:#E1E4E8;">(err);</span></span>
<span class="line"><span style="color:#E1E4E8;">  console.</span><span style="color:#B392F0;">log</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;删除成功!&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">});</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">// unlink</span></span>
<span class="line"><span style="color:#24292E;">fs.</span><span style="color:#6F42C1;">unlink</span><span style="color:#24292E;">(path.</span><span style="color:#6F42C1;">resolve</span><span style="color:#24292E;">(rootPath, </span><span style="color:#032F62;">&quot;./02.txt&quot;</span><span style="color:#24292E;">), (</span><span style="color:#E36209;">err</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (err) </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> console.</span><span style="color:#6F42C1;">log</span><span style="color:#24292E;">(err);</span></span>
<span class="line"><span style="color:#24292E;">  console.</span><span style="color:#6F42C1;">log</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;删除成功!&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">});</span></span></code></pre></div><h2 id="三、指定位置操作文件" tabindex="-1">三、指定位置操作文件 <a class="header-anchor" href="#三、指定位置操作文件" aria-label="Permalink to &quot;三、指定位置操作文件&quot;">​</a></h2><p>​ 接下来的高级文件操作会与上面有些不同，流程稍微复杂一些，要先用<code>fs.open</code>来打开文件，然后才可以用<code>fs.read</code>去读，或者用<code>fs.write</code>去写文件，最后，你需要用<code>fs.close</code>去关掉文件。</p><h3 id="_1-fs-open" tabindex="-1">1.fs.open <a class="header-anchor" href="#_1-fs-open" aria-label="Permalink to &quot;1.fs.open&quot;">​</a></h3><p>​ fs.open 可以打开文件。</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">fs.</span><span style="color:#B392F0;">open</span><span style="color:#E1E4E8;">(path, flags, [mode], callback);</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">fs.</span><span style="color:#6F42C1;">open</span><span style="color:#24292E;">(path, flags, [mode], callback);</span></span></code></pre></div><p>path 文件路径</p><p>flags 标识位，默认<code>r</code></p><p>mode 文件权限位，默认<code>0o666</code></p><p>callback 打开的回调:callback 可以接受两个参数，第一个是<code>err</code>错误信息，第二个是<code>fd</code>文件描述符。这个文件描述符可以帮助我们快速的操作文件而不是使用路径。</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">fs</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">require</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;fs&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">path</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">require</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;path&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">rootPath</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> path.</span><span style="color:#B392F0;">resolve</span><span style="color:#E1E4E8;">(__dirname, </span><span style="color:#9ECBFF;">&quot;../test&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">fs.</span><span style="color:#B392F0;">open</span><span style="color:#E1E4E8;">(path.</span><span style="color:#B392F0;">resolve</span><span style="color:#E1E4E8;">(rootPath, </span><span style="color:#9ECBFF;">&quot;./01.txt&quot;</span><span style="color:#E1E4E8;">), </span><span style="color:#9ECBFF;">&quot;r&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&quot;0666&quot;</span><span style="color:#E1E4E8;">, (</span><span style="color:#FFAB70;">err</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">fd</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (err) </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> console.</span><span style="color:#B392F0;">log</span><span style="color:#E1E4E8;">(err);</span></span>
<span class="line"><span style="color:#E1E4E8;">  console.</span><span style="color:#B392F0;">log</span><span style="color:#E1E4E8;">(fd); </span><span style="color:#6A737D;">// 文件描述符</span></span>
<span class="line"><span style="color:#E1E4E8;">});</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">fs</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">require</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;fs&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">path</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">require</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;path&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">rootPath</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> path.</span><span style="color:#6F42C1;">resolve</span><span style="color:#24292E;">(__dirname, </span><span style="color:#032F62;">&quot;../test&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">fs.</span><span style="color:#6F42C1;">open</span><span style="color:#24292E;">(path.</span><span style="color:#6F42C1;">resolve</span><span style="color:#24292E;">(rootPath, </span><span style="color:#032F62;">&quot;./01.txt&quot;</span><span style="color:#24292E;">), </span><span style="color:#032F62;">&quot;r&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;0666&quot;</span><span style="color:#24292E;">, (</span><span style="color:#E36209;">err</span><span style="color:#24292E;">, </span><span style="color:#E36209;">fd</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (err) </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> console.</span><span style="color:#6F42C1;">log</span><span style="color:#24292E;">(err);</span></span>
<span class="line"><span style="color:#24292E;">  console.</span><span style="color:#6F42C1;">log</span><span style="color:#24292E;">(fd); </span><span style="color:#6A737D;">// 文件描述符</span></span>
<span class="line"><span style="color:#24292E;">});</span></span></code></pre></div><h3 id="_2-fs-read" tabindex="-1">2.fs.read <a class="header-anchor" href="#_2-fs-read" aria-label="Permalink to &quot;2.fs.read&quot;">​</a></h3><p>​ read 函数可以读取文件指定长度的数据。</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">fs.</span><span style="color:#B392F0;">read</span><span style="color:#E1E4E8;">(fd, buffer, offset, length, position, callback);</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">fs.</span><span style="color:#6F42C1;">read</span><span style="color:#24292E;">(fd, buffer, offset, length, position, callback);</span></span></code></pre></div><p>fd：文件描述符，需要先使用 open 打开，使用<code>fs.open</code>打开成功后返回的文件描述符；</p><p>buffer：一个 Buffer 对象，<code>v8</code>引擎分配的一段内存，要将内容读取到的 Buffer；</p><p>offset：整数，向 Buffer 缓存区写入的初始位置，以字节为单位；</p><p>length：整数，读取文件的长度；</p><p>position：整数，读取文件初始位置；文件大小以字节为单位</p><p>callback：回调函数，有三个参数 err（错误），bytesRead（实际读取的字节数），buffer（被写入的缓存区对象），读取执行完成后执行。</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">// read</span></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">fs</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">require</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;fs&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">path</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">require</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;path&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">rootPath</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> path.</span><span style="color:#B392F0;">resolve</span><span style="color:#E1E4E8;">(__dirname, </span><span style="color:#9ECBFF;">&quot;../test&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">fs.</span><span style="color:#B392F0;">open</span><span style="color:#E1E4E8;">(path.</span><span style="color:#B392F0;">resolve</span><span style="color:#E1E4E8;">(rootPath, </span><span style="color:#9ECBFF;">&quot;./01.txt&quot;</span><span style="color:#E1E4E8;">), (</span><span style="color:#FFAB70;">err</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">fd</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (err) </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> console.</span><span style="color:#B392F0;">log</span><span style="color:#E1E4E8;">(err);</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">buf</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> Buffer.</span><span style="color:#B392F0;">alloc</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">9</span><span style="color:#E1E4E8;">); </span><span style="color:#6A737D;">// 创建6个字节长度的缓存数据</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;">// 根据描述符fd来读取文件</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;">// 从文件的第0个字节开始读取九个字节</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;">// 将数据填充到buf对象，起始偏移量为1</span></span>
<span class="line"><span style="color:#E1E4E8;">  fs.</span><span style="color:#B392F0;">read</span><span style="color:#E1E4E8;">(fd, buf, </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">8</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">, (</span><span style="color:#FFAB70;">err</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">data</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">buffer</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (err) </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> console.</span><span style="color:#B392F0;">log</span><span style="color:#E1E4E8;">(err);</span></span>
<span class="line"><span style="color:#E1E4E8;">    console.</span><span style="color:#B392F0;">log</span><span style="color:#E1E4E8;">(buffer.</span><span style="color:#B392F0;">toString</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;utf-8&quot;</span><span style="color:#E1E4E8;">));</span></span>
<span class="line"><span style="color:#E1E4E8;">  });</span></span>
<span class="line"><span style="color:#E1E4E8;">});</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">// read</span></span>
<span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">fs</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">require</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;fs&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">path</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">require</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;path&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">rootPath</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> path.</span><span style="color:#6F42C1;">resolve</span><span style="color:#24292E;">(__dirname, </span><span style="color:#032F62;">&quot;../test&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">fs.</span><span style="color:#6F42C1;">open</span><span style="color:#24292E;">(path.</span><span style="color:#6F42C1;">resolve</span><span style="color:#24292E;">(rootPath, </span><span style="color:#032F62;">&quot;./01.txt&quot;</span><span style="color:#24292E;">), (</span><span style="color:#E36209;">err</span><span style="color:#24292E;">, </span><span style="color:#E36209;">fd</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (err) </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> console.</span><span style="color:#6F42C1;">log</span><span style="color:#24292E;">(err);</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">buf</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> Buffer.</span><span style="color:#6F42C1;">alloc</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">9</span><span style="color:#24292E;">); </span><span style="color:#6A737D;">// 创建6个字节长度的缓存数据</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6A737D;">// 根据描述符fd来读取文件</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6A737D;">// 从文件的第0个字节开始读取九个字节</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6A737D;">// 将数据填充到buf对象，起始偏移量为1</span></span>
<span class="line"><span style="color:#24292E;">  fs.</span><span style="color:#6F42C1;">read</span><span style="color:#24292E;">(fd, buf, </span><span style="color:#005CC5;">1</span><span style="color:#24292E;">, </span><span style="color:#005CC5;">8</span><span style="color:#24292E;">, </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">, (</span><span style="color:#E36209;">err</span><span style="color:#24292E;">, </span><span style="color:#E36209;">data</span><span style="color:#24292E;">, </span><span style="color:#E36209;">buffer</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (err) </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> console.</span><span style="color:#6F42C1;">log</span><span style="color:#24292E;">(err);</span></span>
<span class="line"><span style="color:#24292E;">    console.</span><span style="color:#6F42C1;">log</span><span style="color:#24292E;">(buffer.</span><span style="color:#6F42C1;">toString</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;utf-8&quot;</span><span style="color:#24292E;">));</span></span>
<span class="line"><span style="color:#24292E;">  });</span></span>
<span class="line"><span style="color:#24292E;">});</span></span></code></pre></div><h3 id="_3-fs-write" tabindex="-1">3.fs.write <a class="header-anchor" href="#_3-fs-write" aria-label="Permalink to &quot;3.fs.write&quot;">​</a></h3><p>​ 将缓存对象写入到文件的某个位置中。<strong>注意要写入内容需要以标志位写入的方式打开文件，否则无法写入内容！！！</strong></p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">fs.</span><span style="color:#B392F0;">write</span><span style="color:#E1E4E8;">(fd, buffer, offset, length, position, callback);</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">fs.</span><span style="color:#6F42C1;">write</span><span style="color:#24292E;">(fd, buffer, offset, length, position, callback);</span></span></code></pre></div><p>六个参数</p><ol><li>fd：文件描述符，使用<code>fs.open</code> 打开成功后返回的；</li><li>buffer：一个 Buffer 对象，<code>v8</code> 引擎分配的一段内存，存储将要写入文件数据的 Buffer；</li><li>offset：整数，从 Buffer 缓存区读取数据的初始位置，以字节为单位；</li><li>length：整数，读取 Buffer 数据的字节数；</li><li>position：整数，写入文件初始位置；</li><li>callback：写入操作执行完成后回调函数，有三个参数 err（错误），bytesWritten（实际写入的字节数），buffer（被读取的缓存区对象），写入完成后执行。</li></ol><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">// 以写入的方式打开文件，以非写的方式打开文件是无法写入内容的。</span></span>
<span class="line"><span style="color:#E1E4E8;">fs.</span><span style="color:#B392F0;">open</span><span style="color:#E1E4E8;">(filename, </span><span style="color:#9ECBFF;">&quot;w&quot;</span><span style="color:#E1E4E8;">, (</span><span style="color:#FFAB70;">err</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">fd</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">  fs.</span><span style="color:#B392F0;">write</span><span style="color:#E1E4E8;">(fd, </span><span style="color:#9ECBFF;">&quot;你好~&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">});</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">// 以写入的方式打开文件，以非写的方式打开文件是无法写入内容的。</span></span>
<span class="line"><span style="color:#24292E;">fs.</span><span style="color:#6F42C1;">open</span><span style="color:#24292E;">(filename, </span><span style="color:#032F62;">&quot;w&quot;</span><span style="color:#24292E;">, (</span><span style="color:#E36209;">err</span><span style="color:#24292E;">, </span><span style="color:#E36209;">fd</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">  fs.</span><span style="color:#6F42C1;">write</span><span style="color:#24292E;">(fd, </span><span style="color:#032F62;">&quot;你好~&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">});</span></span></code></pre></div><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">// write</span></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">fs</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">require</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;fs&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">path</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">require</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;path&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">rootPath</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> path.</span><span style="color:#B392F0;">resolve</span><span style="color:#E1E4E8;">(__dirname, </span><span style="color:#9ECBFF;">&quot;../test&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// 使用fs.open完成文件指定位置的复制</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// 打开源文件</span></span>
<span class="line"><span style="color:#E1E4E8;">fs.</span><span style="color:#B392F0;">open</span><span style="color:#E1E4E8;">(path.</span><span style="color:#B392F0;">resolve</span><span style="color:#E1E4E8;">(rootPath, </span><span style="color:#9ECBFF;">&quot;./01.txt&quot;</span><span style="color:#E1E4E8;">), (</span><span style="color:#FFAB70;">err</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">fd</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (err) </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> console.</span><span style="color:#B392F0;">log</span><span style="color:#E1E4E8;">(err);</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;">// 保存读取的缓存数据</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">buffer</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> Buffer.</span><span style="color:#B392F0;">alloc</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">12</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;">// 目标源文件</span></span>
<span class="line"><span style="color:#E1E4E8;">  fs.</span><span style="color:#B392F0;">read</span><span style="color:#E1E4E8;">(fd, buffer, </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">12</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">, (</span><span style="color:#FFAB70;">err</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">num</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">src_buffer</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (err) </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> console.</span><span style="color:#B392F0;">log</span><span style="color:#E1E4E8;">(err);</span></span>
<span class="line"><span style="color:#E1E4E8;">    console.</span><span style="color:#B392F0;">log</span><span style="color:#E1E4E8;">(src_buffer.</span><span style="color:#B392F0;">toString</span><span style="color:#E1E4E8;">()); </span><span style="color:#6A737D;">// 读取目标文件的12个字节</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">// 打开目标文件</span></span>
<span class="line"><span style="color:#E1E4E8;">    fs.</span><span style="color:#B392F0;">open</span><span style="color:#E1E4E8;">(path.</span><span style="color:#B392F0;">resolve</span><span style="color:#E1E4E8;">(rootPath, </span><span style="color:#9ECBFF;">&quot;./02.txt&quot;</span><span style="color:#E1E4E8;">), </span><span style="color:#9ECBFF;">&quot;w&quot;</span><span style="color:#E1E4E8;">, (</span><span style="color:#FFAB70;">err</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">dest_fd</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (err) </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> console.</span><span style="color:#B392F0;">log</span><span style="color:#E1E4E8;">(err);</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#6A737D;">// 将源文件的0-11个字节保存到目标文件中，起始偏移量为0</span></span>
<span class="line"><span style="color:#E1E4E8;">      fs.</span><span style="color:#B392F0;">write</span><span style="color:#E1E4E8;">(dest_fd, src_buffer, </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">12</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">, (</span><span style="color:#FFAB70;">err</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (err) </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> console.</span><span style="color:#B392F0;">log</span><span style="color:#E1E4E8;">(err);</span></span>
<span class="line"><span style="color:#E1E4E8;">      });</span></span>
<span class="line"><span style="color:#E1E4E8;">    });</span></span>
<span class="line"><span style="color:#E1E4E8;">  });</span></span>
<span class="line"><span style="color:#E1E4E8;">});</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">// write</span></span>
<span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">fs</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">require</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;fs&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">path</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">require</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;path&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">rootPath</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> path.</span><span style="color:#6F42C1;">resolve</span><span style="color:#24292E;">(__dirname, </span><span style="color:#032F62;">&quot;../test&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// 使用fs.open完成文件指定位置的复制</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// 打开源文件</span></span>
<span class="line"><span style="color:#24292E;">fs.</span><span style="color:#6F42C1;">open</span><span style="color:#24292E;">(path.</span><span style="color:#6F42C1;">resolve</span><span style="color:#24292E;">(rootPath, </span><span style="color:#032F62;">&quot;./01.txt&quot;</span><span style="color:#24292E;">), (</span><span style="color:#E36209;">err</span><span style="color:#24292E;">, </span><span style="color:#E36209;">fd</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (err) </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> console.</span><span style="color:#6F42C1;">log</span><span style="color:#24292E;">(err);</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6A737D;">// 保存读取的缓存数据</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">buffer</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> Buffer.</span><span style="color:#6F42C1;">alloc</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">12</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6A737D;">// 目标源文件</span></span>
<span class="line"><span style="color:#24292E;">  fs.</span><span style="color:#6F42C1;">read</span><span style="color:#24292E;">(fd, buffer, </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">, </span><span style="color:#005CC5;">12</span><span style="color:#24292E;">, </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">, (</span><span style="color:#E36209;">err</span><span style="color:#24292E;">, </span><span style="color:#E36209;">num</span><span style="color:#24292E;">, </span><span style="color:#E36209;">src_buffer</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (err) </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> console.</span><span style="color:#6F42C1;">log</span><span style="color:#24292E;">(err);</span></span>
<span class="line"><span style="color:#24292E;">    console.</span><span style="color:#6F42C1;">log</span><span style="color:#24292E;">(src_buffer.</span><span style="color:#6F42C1;">toString</span><span style="color:#24292E;">()); </span><span style="color:#6A737D;">// 读取目标文件的12个字节</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">// 打开目标文件</span></span>
<span class="line"><span style="color:#24292E;">    fs.</span><span style="color:#6F42C1;">open</span><span style="color:#24292E;">(path.</span><span style="color:#6F42C1;">resolve</span><span style="color:#24292E;">(rootPath, </span><span style="color:#032F62;">&quot;./02.txt&quot;</span><span style="color:#24292E;">), </span><span style="color:#032F62;">&quot;w&quot;</span><span style="color:#24292E;">, (</span><span style="color:#E36209;">err</span><span style="color:#24292E;">, </span><span style="color:#E36209;">dest_fd</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (err) </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> console.</span><span style="color:#6F42C1;">log</span><span style="color:#24292E;">(err);</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#6A737D;">// 将源文件的0-11个字节保存到目标文件中，起始偏移量为0</span></span>
<span class="line"><span style="color:#24292E;">      fs.</span><span style="color:#6F42C1;">write</span><span style="color:#24292E;">(dest_fd, src_buffer, </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">, </span><span style="color:#005CC5;">12</span><span style="color:#24292E;">, </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">, (</span><span style="color:#E36209;">err</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (err) </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> console.</span><span style="color:#6F42C1;">log</span><span style="color:#24292E;">(err);</span></span>
<span class="line"><span style="color:#24292E;">      });</span></span>
<span class="line"><span style="color:#24292E;">    });</span></span>
<span class="line"><span style="color:#24292E;">  });</span></span>
<span class="line"><span style="color:#24292E;">});</span></span></code></pre></div><h3 id="_4-fs-close" tabindex="-1">4.fs.close <a class="header-anchor" href="#_4-fs-close" aria-label="Permalink to &quot;4.fs.close&quot;">​</a></h3><p>close 用来关闭文件，通过文件描述符关闭文件。</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">fs.</span><span style="color:#B392F0;">close</span><span style="color:#E1E4E8;">(fd, callback);</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">fs.</span><span style="color:#6F42C1;">close</span><span style="color:#24292E;">(fd, callback);</span></span></code></pre></div><p><code>fd</code>要关闭哪个文件？</p><p><code>callback</code>关闭的回调，接受一个 err 参数</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">fs.</span><span style="color:#B392F0;">open</span><span style="color:#E1E4E8;">(</span><span style="color:#B392F0;">require</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;path&quot;</span><span style="color:#E1E4E8;">).</span><span style="color:#B392F0;">resolve</span><span style="color:#E1E4E8;">(rootPath, </span><span style="color:#9ECBFF;">&quot;01.txt&quot;</span><span style="color:#E1E4E8;">), (</span><span style="color:#FFAB70;">err</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">fd</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (err) </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> console.</span><span style="color:#B392F0;">log</span><span style="color:#E1E4E8;">(err);</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">buf</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> Buffer.</span><span style="color:#B392F0;">alloc</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">3</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">  fs.</span><span style="color:#B392F0;">read</span><span style="color:#E1E4E8;">(fd, buf, </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">3</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">3</span><span style="color:#E1E4E8;">, (</span><span style="color:#FFAB70;">err</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">_</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">buffer</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">    console.</span><span style="color:#B392F0;">log</span><span style="color:#E1E4E8;">(fd); </span><span style="color:#6A737D;">// 3</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">// 关闭文件，会释放对应文件描述符</span></span>
<span class="line"><span style="color:#E1E4E8;">    fs.</span><span style="color:#B392F0;">close</span><span style="color:#E1E4E8;">(fd, (</span><span style="color:#FFAB70;">err</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (err) </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> console.</span><span style="color:#B392F0;">log</span><span style="color:#E1E4E8;">(err);</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#6A737D;">// 重新打开文件</span></span>
<span class="line"><span style="color:#E1E4E8;">      fs.</span><span style="color:#B392F0;">open</span><span style="color:#E1E4E8;">(</span><span style="color:#B392F0;">require</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;path&quot;</span><span style="color:#E1E4E8;">).</span><span style="color:#B392F0;">resolve</span><span style="color:#E1E4E8;">(rootPath, </span><span style="color:#9ECBFF;">&quot;01.txt&quot;</span><span style="color:#E1E4E8;">), (</span><span style="color:#FFAB70;">err</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">_fd</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">        console.</span><span style="color:#B392F0;">log</span><span style="color:#E1E4E8;">(_fd); </span><span style="color:#6A737D;">// 3</span></span>
<span class="line"><span style="color:#E1E4E8;">      });</span></span>
<span class="line"><span style="color:#E1E4E8;">    });</span></span>
<span class="line"><span style="color:#E1E4E8;">  });</span></span>
<span class="line"><span style="color:#E1E4E8;">});</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">fs.</span><span style="color:#6F42C1;">open</span><span style="color:#24292E;">(</span><span style="color:#6F42C1;">require</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;path&quot;</span><span style="color:#24292E;">).</span><span style="color:#6F42C1;">resolve</span><span style="color:#24292E;">(rootPath, </span><span style="color:#032F62;">&quot;01.txt&quot;</span><span style="color:#24292E;">), (</span><span style="color:#E36209;">err</span><span style="color:#24292E;">, </span><span style="color:#E36209;">fd</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (err) </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> console.</span><span style="color:#6F42C1;">log</span><span style="color:#24292E;">(err);</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">buf</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> Buffer.</span><span style="color:#6F42C1;">alloc</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">3</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">  fs.</span><span style="color:#6F42C1;">read</span><span style="color:#24292E;">(fd, buf, </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">, </span><span style="color:#005CC5;">3</span><span style="color:#24292E;">, </span><span style="color:#005CC5;">3</span><span style="color:#24292E;">, (</span><span style="color:#E36209;">err</span><span style="color:#24292E;">, </span><span style="color:#E36209;">_</span><span style="color:#24292E;">, </span><span style="color:#E36209;">buffer</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">    console.</span><span style="color:#6F42C1;">log</span><span style="color:#24292E;">(fd); </span><span style="color:#6A737D;">// 3</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">// 关闭文件，会释放对应文件描述符</span></span>
<span class="line"><span style="color:#24292E;">    fs.</span><span style="color:#6F42C1;">close</span><span style="color:#24292E;">(fd, (</span><span style="color:#E36209;">err</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (err) </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> console.</span><span style="color:#6F42C1;">log</span><span style="color:#24292E;">(err);</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#6A737D;">// 重新打开文件</span></span>
<span class="line"><span style="color:#24292E;">      fs.</span><span style="color:#6F42C1;">open</span><span style="color:#24292E;">(</span><span style="color:#6F42C1;">require</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;path&quot;</span><span style="color:#24292E;">).</span><span style="color:#6F42C1;">resolve</span><span style="color:#24292E;">(rootPath, </span><span style="color:#032F62;">&quot;01.txt&quot;</span><span style="color:#24292E;">), (</span><span style="color:#E36209;">err</span><span style="color:#24292E;">, </span><span style="color:#E36209;">_fd</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">        console.</span><span style="color:#6F42C1;">log</span><span style="color:#24292E;">(_fd); </span><span style="color:#6A737D;">// 3</span></span>
<span class="line"><span style="color:#24292E;">      });</span></span>
<span class="line"><span style="color:#24292E;">    });</span></span>
<span class="line"><span style="color:#24292E;">  });</span></span>
<span class="line"><span style="color:#24292E;">});</span></span></code></pre></div><h3 id="_5-fs-sync" tabindex="-1">5.fs.sync <a class="header-anchor" href="#_5-fs-sync" aria-label="Permalink to &quot;5.fs.sync&quot;">​</a></h3><p>​ 让文件与计算机存储的文件同步。</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">fs.fsync(fd, callback);</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">fs.fsync(fd, callback);</span></span></code></pre></div><p>**参数：**该方法接受上述和以下所述的两个参数：</p><ul><li>**fd:**它是一种以同步方式获取的文件描述符(整数)。</li><li>**callback:**它是一个回调函数，用于检查是否发生任何错误。</li></ul><p>**返回值：**此函数不返回任何值。</p><h2 id="四、目录" tabindex="-1">四、目录 <a class="header-anchor" href="#四、目录" aria-label="Permalink to &quot;四、目录&quot;">​</a></h2><h3 id="_1-fs-stat" tabindex="-1">1.fs.stat <a class="header-anchor" href="#_1-fs-stat" aria-label="Permalink to &quot;1.fs.stat&quot;">​</a></h3><p>​ 查看文件的基本信息，包括创建时间、修改时间等信息。回调接受两个参数，err 和 stats</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">fs.</span><span style="color:#B392F0;">stat</span><span style="color:#E1E4E8;">(path, callback);</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">fs.</span><span style="color:#6F42C1;">stat</span><span style="color:#24292E;">(path, callback);</span></span></code></pre></div><p>stats 包括了以下数据</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">1. Stats {</span></span>
<span class="line"><span style="color:#e1e4e8;">2. dev: 2114,          // 包含文件的设备的数字标识符。</span></span>
<span class="line"><span style="color:#e1e4e8;">3. ino: 48064969,      // 文件的特定于文件系统的“Inode”编号。</span></span>
<span class="line"><span style="color:#e1e4e8;">4. mode: 33188,        // 描述文件类型和模式的位字段。</span></span>
<span class="line"><span style="color:#e1e4e8;">5. nlink: 1,           // 该文件存在的硬链接数。</span></span>
<span class="line"><span style="color:#e1e4e8;">6. uid: 85,            // 拥有文件（POSIX）的用户的数字用户标识符。</span></span>
<span class="line"><span style="color:#e1e4e8;">7. gid: 100,           // 拥有文件（POSIX）的组的数字组标识符。</span></span>
<span class="line"><span style="color:#e1e4e8;">8. rdev: 0,            // 如果文件表示设备，则为数字设备标识符。</span></span>
<span class="line"><span style="color:#e1e4e8;">9. size: 527,          // 文件的大小（以字节为单位）。</span></span>
<span class="line"><span style="color:#e1e4e8;">10. blksize: 4096,      // 用于i/o操作的文件系统块大小。</span></span>
<span class="line"><span style="color:#e1e4e8;">11. blocks: 8,          // 为此文件分配的块数。</span></span>
<span class="line"><span style="color:#e1e4e8;">12. atimeMs: 1318289051000.1,      // 最后一次访问此文件的时间戳（以毫秒为单位）。</span></span>
<span class="line"><span style="color:#e1e4e8;">13. mtimeMs: 1318289051000.1,      // 最后一次修改此文件的时间戳（以毫秒为单位）</span></span>
<span class="line"><span style="color:#e1e4e8;">14. ctimeMs: 1318289051000.1,      // 最后一次更改文件状态的时间戳（以毫秒为单位）</span></span>
<span class="line"><span style="color:#e1e4e8;">15. birthtimeMs: 1318289051000.1,  // 此文件创建时间的时间戳（以毫秒为单位）</span></span>
<span class="line"><span style="color:#e1e4e8;">16. atime: Mon, 10 Oct 2011 23:24:11 GMT,       // 指示上次访问此文件的时间。</span></span>
<span class="line"><span style="color:#e1e4e8;">17. mtime: Mon, 10 Oct 2011 23:24:11 GMT,       // 上次修改此文件的时间。</span></span>
<span class="line"><span style="color:#e1e4e8;">18. ctime: Mon, 10 Oct 2011 23:24:11 GMT,       // 上次更改文件状态的时间。</span></span>
<span class="line"><span style="color:#e1e4e8;">19. birthtime: Mon, 10 Oct 2011 23:24:11 GMT    // 此文件创建时间的时间。</span></span>
<span class="line"><span style="color:#e1e4e8;">20. }</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">1. Stats {</span></span>
<span class="line"><span style="color:#24292e;">2. dev: 2114,          // 包含文件的设备的数字标识符。</span></span>
<span class="line"><span style="color:#24292e;">3. ino: 48064969,      // 文件的特定于文件系统的“Inode”编号。</span></span>
<span class="line"><span style="color:#24292e;">4. mode: 33188,        // 描述文件类型和模式的位字段。</span></span>
<span class="line"><span style="color:#24292e;">5. nlink: 1,           // 该文件存在的硬链接数。</span></span>
<span class="line"><span style="color:#24292e;">6. uid: 85,            // 拥有文件（POSIX）的用户的数字用户标识符。</span></span>
<span class="line"><span style="color:#24292e;">7. gid: 100,           // 拥有文件（POSIX）的组的数字组标识符。</span></span>
<span class="line"><span style="color:#24292e;">8. rdev: 0,            // 如果文件表示设备，则为数字设备标识符。</span></span>
<span class="line"><span style="color:#24292e;">9. size: 527,          // 文件的大小（以字节为单位）。</span></span>
<span class="line"><span style="color:#24292e;">10. blksize: 4096,      // 用于i/o操作的文件系统块大小。</span></span>
<span class="line"><span style="color:#24292e;">11. blocks: 8,          // 为此文件分配的块数。</span></span>
<span class="line"><span style="color:#24292e;">12. atimeMs: 1318289051000.1,      // 最后一次访问此文件的时间戳（以毫秒为单位）。</span></span>
<span class="line"><span style="color:#24292e;">13. mtimeMs: 1318289051000.1,      // 最后一次修改此文件的时间戳（以毫秒为单位）</span></span>
<span class="line"><span style="color:#24292e;">14. ctimeMs: 1318289051000.1,      // 最后一次更改文件状态的时间戳（以毫秒为单位）</span></span>
<span class="line"><span style="color:#24292e;">15. birthtimeMs: 1318289051000.1,  // 此文件创建时间的时间戳（以毫秒为单位）</span></span>
<span class="line"><span style="color:#24292e;">16. atime: Mon, 10 Oct 2011 23:24:11 GMT,       // 指示上次访问此文件的时间。</span></span>
<span class="line"><span style="color:#24292e;">17. mtime: Mon, 10 Oct 2011 23:24:11 GMT,       // 上次修改此文件的时间。</span></span>
<span class="line"><span style="color:#24292e;">18. ctime: Mon, 10 Oct 2011 23:24:11 GMT,       // 上次更改文件状态的时间。</span></span>
<span class="line"><span style="color:#24292e;">19. birthtime: Mon, 10 Oct 2011 23:24:11 GMT    // 此文件创建时间的时间。</span></span>
<span class="line"><span style="color:#24292e;">20. }</span></span></code></pre></div><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">fs.</span><span style="color:#B392F0;">stat</span><span style="color:#E1E4E8;">(path.</span><span style="color:#B392F0;">resolve</span><span style="color:#E1E4E8;">(rootPath), (</span><span style="color:#FFAB70;">err</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">stats</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (err) </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> console.</span><span style="color:#B392F0;">log</span><span style="color:#E1E4E8;">(err);</span></span>
<span class="line"><span style="color:#E1E4E8;">  console.</span><span style="color:#B392F0;">log</span><span style="color:#E1E4E8;">(stats.</span><span style="color:#B392F0;">isDirectory</span><span style="color:#E1E4E8;">()); </span><span style="color:#6A737D;">// 是否是目录</span></span>
<span class="line"><span style="color:#E1E4E8;">  console.</span><span style="color:#B392F0;">log</span><span style="color:#E1E4E8;">(stats.</span><span style="color:#B392F0;">isFile</span><span style="color:#E1E4E8;">()); </span><span style="color:#6A737D;">// 是否是文件</span></span>
<span class="line"><span style="color:#E1E4E8;">});</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">fs.</span><span style="color:#6F42C1;">stat</span><span style="color:#24292E;">(path.</span><span style="color:#6F42C1;">resolve</span><span style="color:#24292E;">(rootPath), (</span><span style="color:#E36209;">err</span><span style="color:#24292E;">, </span><span style="color:#E36209;">stats</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (err) </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> console.</span><span style="color:#6F42C1;">log</span><span style="color:#24292E;">(err);</span></span>
<span class="line"><span style="color:#24292E;">  console.</span><span style="color:#6F42C1;">log</span><span style="color:#24292E;">(stats.</span><span style="color:#6F42C1;">isDirectory</span><span style="color:#24292E;">()); </span><span style="color:#6A737D;">// 是否是目录</span></span>
<span class="line"><span style="color:#24292E;">  console.</span><span style="color:#6F42C1;">log</span><span style="color:#24292E;">(stats.</span><span style="color:#6F42C1;">isFile</span><span style="color:#24292E;">()); </span><span style="color:#6A737D;">// 是否是文件</span></span>
<span class="line"><span style="color:#24292E;">});</span></span></code></pre></div><h3 id="_2-fs-mkdir" tabindex="-1">2.fs.mkdir <a class="header-anchor" href="#_2-fs-mkdir" aria-label="Permalink to &quot;2.fs.mkdir&quot;">​</a></h3><p>​ 创建文件夹。</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">fs.</span><span style="color:#B392F0;">mkdir</span><span style="color:#E1E4E8;">(path, [options], callback);</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">fs.</span><span style="color:#6F42C1;">mkdir</span><span style="color:#24292E;">(path, [options], callback);</span></span></code></pre></div><p>第一个参数：path 目录路径</p><p>第二个参数[options]，<code>recursive &lt;boolean&gt;</code> 默认值: false。 <code>mode &lt;integer&gt;</code> Windows 上不支持。默认值: 0o777。 可选的 options 参数可以是指定模式（权限和粘滞位）的整数，也可以是具有 mode 属性和 recursive 属性（指示是否应创建父文件夹）的对象。</p><p>第三个参数回调函数,回调函数有一个参数 err（错误），创建文件夹后执行。</p><p><strong>注意</strong>：未开启递归选项时，若文件夹已经存在了则创建文件夹会失败。</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">fs.</span><span style="color:#B392F0;">mkdir</span><span style="color:#E1E4E8;">(path.</span><span style="color:#B392F0;">resolve</span><span style="color:#E1E4E8;">(rootPath, </span><span style="color:#9ECBFF;">&quot;./00&quot;</span><span style="color:#E1E4E8;">), (</span><span style="color:#FFAB70;">err</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (err) </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> console.</span><span style="color:#B392F0;">log</span><span style="color:#E1E4E8;">(err);</span></span>
<span class="line"><span style="color:#E1E4E8;">  console.</span><span style="color:#B392F0;">log</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;创建文件夹成功!&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">});</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">fs.</span><span style="color:#B392F0;">mkdir</span><span style="color:#E1E4E8;">(</span></span>
<span class="line"><span style="color:#E1E4E8;">  path.</span><span style="color:#B392F0;">resolve</span><span style="color:#E1E4E8;">(rootPath, </span><span style="color:#9ECBFF;">&quot;./00/01&quot;</span><span style="color:#E1E4E8;">),</span></span>
<span class="line"><span style="color:#E1E4E8;">  { recursive: </span><span style="color:#79B8FF;">true</span><span style="color:#E1E4E8;"> }, </span><span style="color:#6A737D;">// 开启递归选项，若路径中有文件夹不存在会帮你自动创建</span></span>
<span class="line"><span style="color:#E1E4E8;">  (</span><span style="color:#FFAB70;">err</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (err) </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> console.</span><span style="color:#B392F0;">log</span><span style="color:#E1E4E8;">(err);</span></span>
<span class="line"><span style="color:#E1E4E8;">    console.</span><span style="color:#B392F0;">log</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;创建递归文件夹成功!&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">  }</span></span>
<span class="line"><span style="color:#E1E4E8;">);</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">fs.</span><span style="color:#6F42C1;">mkdir</span><span style="color:#24292E;">(path.</span><span style="color:#6F42C1;">resolve</span><span style="color:#24292E;">(rootPath, </span><span style="color:#032F62;">&quot;./00&quot;</span><span style="color:#24292E;">), (</span><span style="color:#E36209;">err</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (err) </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> console.</span><span style="color:#6F42C1;">log</span><span style="color:#24292E;">(err);</span></span>
<span class="line"><span style="color:#24292E;">  console.</span><span style="color:#6F42C1;">log</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;创建文件夹成功!&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">});</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">fs.</span><span style="color:#6F42C1;">mkdir</span><span style="color:#24292E;">(</span></span>
<span class="line"><span style="color:#24292E;">  path.</span><span style="color:#6F42C1;">resolve</span><span style="color:#24292E;">(rootPath, </span><span style="color:#032F62;">&quot;./00/01&quot;</span><span style="color:#24292E;">),</span></span>
<span class="line"><span style="color:#24292E;">  { recursive: </span><span style="color:#005CC5;">true</span><span style="color:#24292E;"> }, </span><span style="color:#6A737D;">// 开启递归选项，若路径中有文件夹不存在会帮你自动创建</span></span>
<span class="line"><span style="color:#24292E;">  (</span><span style="color:#E36209;">err</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (err) </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> console.</span><span style="color:#6F42C1;">log</span><span style="color:#24292E;">(err);</span></span>
<span class="line"><span style="color:#24292E;">    console.</span><span style="color:#6F42C1;">log</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;创建递归文件夹成功!&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">  }</span></span>
<span class="line"><span style="color:#24292E;">);</span></span></code></pre></div><h3 id="_3-fs-rmdir" tabindex="-1">3.fs.rmdir <a class="header-anchor" href="#_3-fs-rmdir" aria-label="Permalink to &quot;3.fs.rmdir&quot;">​</a></h3><p>​ fs.rmdir 用来删除<strong>空</strong>文件夹，若文件夹中有文件是不允许删除的</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">fs.</span><span style="color:#B392F0;">rmdir</span><span style="color:#E1E4E8;">(path, callback);</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">fs.</span><span style="color:#6F42C1;">rmdir</span><span style="color:#24292E;">(path, callback);</span></span></code></pre></div><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">fs.</span><span style="color:#B392F0;">mkdir</span><span style="color:#E1E4E8;">(dPath, (</span><span style="color:#FFAB70;">err</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (err) </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> console.</span><span style="color:#B392F0;">log</span><span style="color:#E1E4E8;">(err);</span></span>
<span class="line"><span style="color:#E1E4E8;">  console.</span><span style="color:#B392F0;">log</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;创建文件夹成功&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">debugger</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">  fs.</span><span style="color:#B392F0;">rmdir</span><span style="color:#E1E4E8;">(dPath, (</span><span style="color:#FFAB70;">err</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (err) </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> console.</span><span style="color:#B392F0;">log</span><span style="color:#E1E4E8;">(err);</span></span>
<span class="line"><span style="color:#E1E4E8;">    console.</span><span style="color:#B392F0;">log</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;删除文件夹成功&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">  });</span></span>
<span class="line"><span style="color:#E1E4E8;">});</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">fs.</span><span style="color:#6F42C1;">mkdir</span><span style="color:#24292E;">(dPath, (</span><span style="color:#E36209;">err</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (err) </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> console.</span><span style="color:#6F42C1;">log</span><span style="color:#24292E;">(err);</span></span>
<span class="line"><span style="color:#24292E;">  console.</span><span style="color:#6F42C1;">log</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;创建文件夹成功&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">debugger</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">  fs.</span><span style="color:#6F42C1;">rmdir</span><span style="color:#24292E;">(dPath, (</span><span style="color:#E36209;">err</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (err) </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> console.</span><span style="color:#6F42C1;">log</span><span style="color:#24292E;">(err);</span></span>
<span class="line"><span style="color:#24292E;">    console.</span><span style="color:#6F42C1;">log</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;删除文件夹成功&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">  });</span></span>
<span class="line"><span style="color:#24292E;">});</span></span></code></pre></div><h3 id="_4-fs-readdir" tabindex="-1">4.fs.readdir <a class="header-anchor" href="#_4-fs-readdir" aria-label="Permalink to &quot;4.fs.readdir&quot;">​</a></h3><p>​ fs.readdir 用来读取目录</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">fs.</span><span style="color:#B392F0;">readdir</span><span style="color:#E1E4E8;">(path, options, callback);</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">fs.</span><span style="color:#6F42C1;">readdir</span><span style="color:#24292E;">(path, options, callback);</span></span></code></pre></div><p>第一个参数：path 目录路径</p><p>第二个参数[options]可选的 options 参数可以是指定编码的字符串，也可以是具有 encoding 属性的对象，该属性指定用于传给回调的文件名的字符编码。 如果 encoding 设置为 &#39;buffer&#39;，则返回的文件名是 Buffer 对象。 如果 options.withFileTypes 设置为 true，则 files 数组将包含 fs.Dirent 对象。</p><p>第三个参数回调函数,回调函数有两个参数，第一个 err（错误），第二个返回 的 data 为一个数组，包含该文件夹的所有文件，是目录中的文件名的数组（不包括 <code>&#39;.&#39;</code> 和 <code>&#39;..&#39;</code>）。</p><p>回调接受两个参数，err 和 fileNameList，错误信息以及该文件夹中的文件列表（包括了文件夹和文件）</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">path</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">require</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;path&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">fs</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">require</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;fs&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">rootPath</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> path.</span><span style="color:#B392F0;">resolve</span><span style="color:#E1E4E8;">(__dirname, </span><span style="color:#9ECBFF;">&quot;../test&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// 默认utf-8编码输出文件名称</span></span>
<span class="line"><span style="color:#E1E4E8;">fs.</span><span style="color:#B392F0;">readdir</span><span style="color:#E1E4E8;">(rootPath, (</span><span style="color:#FFAB70;">err</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">files</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (err) </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> console.</span><span style="color:#B392F0;">log</span><span style="color:#E1E4E8;">(err);</span></span>
<span class="line"><span style="color:#E1E4E8;">  console.</span><span style="color:#B392F0;">log</span><span style="color:#E1E4E8;">(files); </span><span style="color:#6A737D;">// 包含文件夹以及文件</span></span>
<span class="line"><span style="color:#E1E4E8;">});</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// 指定buffer对象输出文件名称</span></span>
<span class="line"><span style="color:#E1E4E8;">fs.</span><span style="color:#B392F0;">readdir</span><span style="color:#E1E4E8;">(rootPath, </span><span style="color:#9ECBFF;">&quot;buffer&quot;</span><span style="color:#E1E4E8;">, (</span><span style="color:#FFAB70;">err</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">files</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (err) </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> console.</span><span style="color:#B392F0;">log</span><span style="color:#E1E4E8;">(err);</span></span>
<span class="line"><span style="color:#E1E4E8;">  console.</span><span style="color:#B392F0;">log</span><span style="color:#E1E4E8;">(files); </span><span style="color:#6A737D;">// 包含文件夹以及文件</span></span>
<span class="line"><span style="color:#E1E4E8;">});</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">path</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">require</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;path&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">fs</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">require</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;fs&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">rootPath</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> path.</span><span style="color:#6F42C1;">resolve</span><span style="color:#24292E;">(__dirname, </span><span style="color:#032F62;">&quot;../test&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// 默认utf-8编码输出文件名称</span></span>
<span class="line"><span style="color:#24292E;">fs.</span><span style="color:#6F42C1;">readdir</span><span style="color:#24292E;">(rootPath, (</span><span style="color:#E36209;">err</span><span style="color:#24292E;">, </span><span style="color:#E36209;">files</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (err) </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> console.</span><span style="color:#6F42C1;">log</span><span style="color:#24292E;">(err);</span></span>
<span class="line"><span style="color:#24292E;">  console.</span><span style="color:#6F42C1;">log</span><span style="color:#24292E;">(files); </span><span style="color:#6A737D;">// 包含文件夹以及文件</span></span>
<span class="line"><span style="color:#24292E;">});</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// 指定buffer对象输出文件名称</span></span>
<span class="line"><span style="color:#24292E;">fs.</span><span style="color:#6F42C1;">readdir</span><span style="color:#24292E;">(rootPath, </span><span style="color:#032F62;">&quot;buffer&quot;</span><span style="color:#24292E;">, (</span><span style="color:#E36209;">err</span><span style="color:#24292E;">, </span><span style="color:#E36209;">files</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (err) </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> console.</span><span style="color:#6F42C1;">log</span><span style="color:#24292E;">(err);</span></span>
<span class="line"><span style="color:#24292E;">  console.</span><span style="color:#6F42C1;">log</span><span style="color:#24292E;">(files); </span><span style="color:#6A737D;">// 包含文件夹以及文件</span></span>
<span class="line"><span style="color:#24292E;">});</span></span></code></pre></div><h3 id="_5-fs-chmod" tabindex="-1">5.fs.chmod <a class="header-anchor" href="#_5-fs-chmod" aria-label="Permalink to &quot;5.fs.chmod&quot;">​</a></h3><p>​ fs.chmod 修改文件或文件夹的权限，通过权限位来设置对应文件或文件夹的权限</p><p>​ 该方法只能适用于<code>unix</code>操作系统，在<code>windows</code>操作系统上执行不会生效。</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">fs.</span><span style="color:#B392F0;">chmod</span><span style="color:#E1E4E8;">(path, mode, callback);</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">fs.</span><span style="color:#6F42C1;">chmod</span><span style="color:#24292E;">(path, mode, callback);</span></span></code></pre></div><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">fs.</span><span style="color:#B392F0;">chmod</span><span style="color:#E1E4E8;">(rootPath, </span><span style="color:#79B8FF;">0o600</span><span style="color:#E1E4E8;">, (</span><span style="color:#FFAB70;">err</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;">//0o600 所有者可读可写。</span></span>
<span class="line"><span style="color:#E1E4E8;">  console.</span><span style="color:#B392F0;">log</span><span style="color:#E1E4E8;">(err);</span></span>
<span class="line"><span style="color:#E1E4E8;">});</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">fs.</span><span style="color:#6F42C1;">chmod</span><span style="color:#24292E;">(rootPath, </span><span style="color:#005CC5;">0o600</span><span style="color:#24292E;">, (</span><span style="color:#E36209;">err</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6A737D;">//0o600 所有者可读可写。</span></span>
<span class="line"><span style="color:#24292E;">  console.</span><span style="color:#6F42C1;">log</span><span style="color:#24292E;">(err);</span></span>
<span class="line"><span style="color:#24292E;">});</span></span></code></pre></div><h3 id="_6-fs-access" tabindex="-1">6.fs.access <a class="header-anchor" href="#_6-fs-access" aria-label="Permalink to &quot;6.fs.access&quot;">​</a></h3><p>​ fs.access 查询是否有对应权限。mode 权限位，查看文件或文件夹是否满足该权限位。</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">fs.</span><span style="color:#B392F0;">access</span><span style="color:#E1E4E8;">(path, mode, callback);</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">fs.</span><span style="color:#6F42C1;">access</span><span style="color:#24292E;">(path, mode, callback);</span></span></code></pre></div><p>mode 的取值为</p><p><code>F_OK</code>指示文件对调用进程可见的标志。 这对于确定文件是否存在很有用，但没有说明 <code>rwx</code> 权限。 未指定模式时的默认值。</p><p><code>R_OK</code>指示文件可以被调用进程读取的标志。</p><p><code>W_OK</code>指示文件可以被调用进程写入的标志。</p><p><code>X_OK</code>指示文件可以被调用进程执行的标志。 这对 Windows 没有影响（将表现得像 <code>fs.constants.F_OK</code>）。</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">// 调用进程是否可读</span></span>
<span class="line"><span style="color:#E1E4E8;">fs.</span><span style="color:#B392F0;">access</span><span style="color:#E1E4E8;">(rootPath, fs.constants.</span><span style="color:#79B8FF;">R_OK</span><span style="color:#E1E4E8;">, (</span><span style="color:#FFAB70;">err</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">  console.</span><span style="color:#B392F0;">log</span><span style="color:#E1E4E8;">(err);</span></span>
<span class="line"><span style="color:#E1E4E8;">});</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">// 调用进程是否可读</span></span>
<span class="line"><span style="color:#24292E;">fs.</span><span style="color:#6F42C1;">access</span><span style="color:#24292E;">(rootPath, fs.constants.</span><span style="color:#005CC5;">R_OK</span><span style="color:#24292E;">, (</span><span style="color:#E36209;">err</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">  console.</span><span style="color:#6F42C1;">log</span><span style="color:#24292E;">(err);</span></span>
<span class="line"><span style="color:#24292E;">});</span></span></code></pre></div><h3 id="_7-fs-rename" tabindex="-1">7.fs.rename <a class="header-anchor" href="#_7-fs-rename" aria-label="Permalink to &quot;7.fs.rename&quot;">​</a></h3><p>​ 重命名文件或文件夹。重命名文件夹时无论文件夹是否有文件都可以成功重命名。</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">// 重命名文件</span></span>
<span class="line"><span style="color:#B392F0;">rename</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;oldFile.txt&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&quot;newFile.txt&quot;</span><span style="color:#E1E4E8;">, (</span><span style="color:#FFAB70;">err</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (err) </span><span style="color:#F97583;">throw</span><span style="color:#E1E4E8;"> err;</span></span>
<span class="line"><span style="color:#E1E4E8;">  console.</span><span style="color:#B392F0;">log</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;Rename complete!&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">});</span></span>
<span class="line"><span style="color:#6A737D;">// 重命名文件夹</span></span>
<span class="line"><span style="color:#E1E4E8;">fs.</span><span style="color:#B392F0;">mkdir</span><span style="color:#E1E4E8;">(path.</span><span style="color:#B392F0;">resolve</span><span style="color:#E1E4E8;">(rootPath, </span><span style="color:#9ECBFF;">&quot;哈哈&quot;</span><span style="color:#E1E4E8;">), (</span><span style="color:#FFAB70;">err</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">  fs.</span><span style="color:#B392F0;">rename</span><span style="color:#E1E4E8;">(</span></span>
<span class="line"><span style="color:#E1E4E8;">    path.</span><span style="color:#B392F0;">resolve</span><span style="color:#E1E4E8;">(rootPath, </span><span style="color:#9ECBFF;">&quot;哈哈&quot;</span><span style="color:#E1E4E8;">),</span></span>
<span class="line"><span style="color:#E1E4E8;">    path.</span><span style="color:#B392F0;">resolve</span><span style="color:#E1E4E8;">(rootPath, </span><span style="color:#9ECBFF;">&quot;喜喜&quot;</span><span style="color:#E1E4E8;">),</span></span>
<span class="line"><span style="color:#E1E4E8;">    (</span><span style="color:#FFAB70;">err</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {}</span></span>
<span class="line"><span style="color:#E1E4E8;">  );</span></span>
<span class="line"><span style="color:#E1E4E8;">});</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">// 重命名文件</span></span>
<span class="line"><span style="color:#6F42C1;">rename</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;oldFile.txt&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;newFile.txt&quot;</span><span style="color:#24292E;">, (</span><span style="color:#E36209;">err</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (err) </span><span style="color:#D73A49;">throw</span><span style="color:#24292E;"> err;</span></span>
<span class="line"><span style="color:#24292E;">  console.</span><span style="color:#6F42C1;">log</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;Rename complete!&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">});</span></span>
<span class="line"><span style="color:#6A737D;">// 重命名文件夹</span></span>
<span class="line"><span style="color:#24292E;">fs.</span><span style="color:#6F42C1;">mkdir</span><span style="color:#24292E;">(path.</span><span style="color:#6F42C1;">resolve</span><span style="color:#24292E;">(rootPath, </span><span style="color:#032F62;">&quot;哈哈&quot;</span><span style="color:#24292E;">), (</span><span style="color:#E36209;">err</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">  fs.</span><span style="color:#6F42C1;">rename</span><span style="color:#24292E;">(</span></span>
<span class="line"><span style="color:#24292E;">    path.</span><span style="color:#6F42C1;">resolve</span><span style="color:#24292E;">(rootPath, </span><span style="color:#032F62;">&quot;哈哈&quot;</span><span style="color:#24292E;">),</span></span>
<span class="line"><span style="color:#24292E;">    path.</span><span style="color:#6F42C1;">resolve</span><span style="color:#24292E;">(rootPath, </span><span style="color:#032F62;">&quot;喜喜&quot;</span><span style="color:#24292E;">),</span></span>
<span class="line"><span style="color:#24292E;">    (</span><span style="color:#E36209;">err</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> {}</span></span>
<span class="line"><span style="color:#24292E;">  );</span></span>
<span class="line"><span style="color:#24292E;">});</span></span></code></pre></div><h3 id="_8-fs-watchfile" tabindex="-1">8.fs.watchFile <a class="header-anchor" href="#_8-fs-watchfile" aria-label="Permalink to &quot;8.fs.watchFile&quot;">​</a></h3><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">fs.</span><span style="color:#B392F0;">watchFile</span><span style="color:#E1E4E8;">(filename[, options], listener)</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">fs.</span><span style="color:#6F42C1;">watchFile</span><span style="color:#24292E;">(filename[, options], listener)</span></span></code></pre></div><p>监视文件的变化。 每次访问（更新？）文件时都会调用回调 <code>listener</code>。</p><p>options 的参数:</p><ul><li><code>bigint</code> <strong>默认值：</strong> <code>false</code></li><li><code>persistent</code><strong>默认值：</strong> <code>true</code></li><li><code>interval</code> <strong>默认值：</strong> <code>5007</code></li></ul><p>可以省略 <code>options</code> 参数。 如果提供，它应该是一个对象。 <code>options</code> 对象可以包含名为 <code>persistent</code> 的布尔值，其指示当文件正在被监视时，进程是否应该继续运行。 <code>options</code> 对象可以指定 <code>interval</code> 属性，指示应该轮询目标的频率（以毫秒为单位）。如果 <code>bigint</code> 选项为 <code>true</code>，则回调中的<code>current</code>，<code>pre</code>这些对象中的数值指定为 <code>BigInt</code>类型</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">fs.</span><span style="color:#B392F0;">watchFile</span><span style="color:#E1E4E8;">(filename, (</span><span style="color:#FFAB70;">current</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">pre</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;">// current当前文件信息</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;">// pre更新前的文件信息</span></span>
<span class="line"><span style="color:#E1E4E8;">  console.</span><span style="color:#B392F0;">log</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;文件更新了!&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">});</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">fs.</span><span style="color:#B392F0;">open</span><span style="color:#E1E4E8;">(filename, </span><span style="color:#9ECBFF;">&quot;a&quot;</span><span style="color:#E1E4E8;">, (</span><span style="color:#FFAB70;">err</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">fd</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">buffer</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> Buffer.</span><span style="color:#B392F0;">from</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;你好~&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">  fs.</span><span style="color:#B392F0;">write</span><span style="color:#E1E4E8;">(fd, buffer, (</span><span style="color:#FFAB70;">err</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">size</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">bf</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">    fs.</span><span style="color:#B392F0;">close</span><span style="color:#E1E4E8;">(fd);</span></span>
<span class="line"><span style="color:#E1E4E8;">  });</span></span>
<span class="line"><span style="color:#E1E4E8;">});</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">fs.</span><span style="color:#6F42C1;">watchFile</span><span style="color:#24292E;">(filename, (</span><span style="color:#E36209;">current</span><span style="color:#24292E;">, </span><span style="color:#E36209;">pre</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6A737D;">// current当前文件信息</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6A737D;">// pre更新前的文件信息</span></span>
<span class="line"><span style="color:#24292E;">  console.</span><span style="color:#6F42C1;">log</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;文件更新了!&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">});</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">fs.</span><span style="color:#6F42C1;">open</span><span style="color:#24292E;">(filename, </span><span style="color:#032F62;">&quot;a&quot;</span><span style="color:#24292E;">, (</span><span style="color:#E36209;">err</span><span style="color:#24292E;">, </span><span style="color:#E36209;">fd</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">buffer</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> Buffer.</span><span style="color:#6F42C1;">from</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;你好~&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">  fs.</span><span style="color:#6F42C1;">write</span><span style="color:#24292E;">(fd, buffer, (</span><span style="color:#E36209;">err</span><span style="color:#24292E;">, </span><span style="color:#E36209;">size</span><span style="color:#24292E;">, </span><span style="color:#E36209;">bf</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">    fs.</span><span style="color:#6F42C1;">close</span><span style="color:#24292E;">(fd);</span></span>
<span class="line"><span style="color:#24292E;">  });</span></span>
<span class="line"><span style="color:#24292E;">});</span></span></code></pre></div><h3 id="_9-fs-watch" tabindex="-1">9.fs.watch <a class="header-anchor" href="#_9-fs-watch" aria-label="Permalink to &quot;9.fs.watch&quot;">​</a></h3><p>​ 监听文件夹变化。文件夹中的任何操作，都会执行<code>listener</code>回调。</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">fs.</span><span style="color:#B392F0;">watch</span><span style="color:#E1E4E8;">(filename[, options][, listener])</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">fs.</span><span style="color:#6F42C1;">watch</span><span style="color:#24292E;">(filename[, options][, listener])</span></span></code></pre></div><p>​ <strong>options</strong>:</p><ul><li><code>persistent</code> 指示只要正在监视文件，进程（当前 node 程序）是否应继续运行。 <strong>默认值：</strong> <code>true</code>。</li><li><code>recursive</code> 指示是应监视所有子目录，还是仅监视当前目录。 这在指定目录时适用，并且仅适用于受支持的平台（参见 <a href="https://nodejs.cn/dist/latest-v18.x/docs/api/fs.html#caveats" target="_blank" rel="noreferrer">caveats</a>）。 <strong>默认值：</strong> <code>false</code>。</li><li><code>encoding</code>指定用于传给监听器的文件名的字符编码。 <strong>默认值：</strong> <code>&#39;utf8&#39;</code>。</li><li><code>signal</code> 允许使用中止信号关闭监视器。</li></ul><p><strong>listener</strong></p><p>接受两个参数，一个 err，一个是更新的标识，取值有:change(更新)、rename（删除、重命名、创建）。只要目录中文件名出现或消失，就会触发 <code>&#39;rename&#39;</code>。</p><h2 id="五、stream" tabindex="-1">五、stream <a class="header-anchor" href="#五、stream" aria-label="Permalink to &quot;五、stream&quot;">​</a></h2><h3 id="介绍" tabindex="-1">介绍 <a class="header-anchor" href="#介绍" aria-label="Permalink to &quot;介绍&quot;">​</a></h3><p>什么是流？流可以接受数据也可以通过管道输送数据，其本质就是让数据流动起来。</p><p>以在线浏览电影为例，在发送请求加载电影时：</p><h4 id="使用-readfile" tabindex="-1">使用 readFile <a class="header-anchor" href="#使用-readfile" aria-label="Permalink to &quot;使用 readFile&quot;">​</a></h4><p>若我们通过 readFile 直接将整个大文件读取到内存中，然后再通过响应对象传输数据响应给客户端，这个就会造成很大的问题：</p><ol><li>将整个文件直接读取到内存中，会占用内存资源造成系统卡顿</li><li>服务器需要耗费流量直接将整个文件传输给客户端，同时占用大量带宽</li><li>客户端每次加载视频都会直接耗费整个文件大小的流量，再次访问用户还是需要重新加载整个文件，造成巨大的流量开销。</li><li>若并发请求过多，服务器系统开销过大，可能会卡死。</li></ol><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">data</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> fs.</span><span style="color:#B392F0;">readFileSync</span><span style="color:#E1E4E8;">(path.</span><span style="color:#B392F0;">resolve</span><span style="color:#E1E4E8;">(rootPath, </span><span style="color:#9ECBFF;">&quot;./01.mp4&quot;</span><span style="color:#E1E4E8;">));</span></span>
<span class="line"><span style="color:#E1E4E8;">res.</span><span style="color:#B392F0;">setHeader</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;Content-Type&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&quot;video&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">res.</span><span style="color:#B392F0;">setHeader</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;cache-control&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&quot;max-age=10000&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">res.</span><span style="color:#B392F0;">end</span><span style="color:#E1E4E8;">(data);</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">data</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> fs.</span><span style="color:#6F42C1;">readFileSync</span><span style="color:#24292E;">(path.</span><span style="color:#6F42C1;">resolve</span><span style="color:#24292E;">(rootPath, </span><span style="color:#032F62;">&quot;./01.mp4&quot;</span><span style="color:#24292E;">));</span></span>
<span class="line"><span style="color:#24292E;">res.</span><span style="color:#6F42C1;">setHeader</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;Content-Type&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;video&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">res.</span><span style="color:#6F42C1;">setHeader</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;cache-control&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;max-age=10000&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">res.</span><span style="color:#6F42C1;">end</span><span style="color:#24292E;">(data);</span></span></code></pre></div><h4 id="使用流" tabindex="-1">使用流 <a class="header-anchor" href="#使用流" aria-label="Permalink to &quot;使用流&quot;">​</a></h4><p>​ 服务端通过分段传输流文件，先加载文件的前 10mb 的内容，响应流给客户端，客户端要看完前再次通过流读后 10mb 内容，响应给客户端....一点一点加载数据，直到视频播放完成。这样一来用户造成的流量开销小了，服务器的性能开销也小了，双赢。</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">// 每次读取1mb的数据</span></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">rs</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> fs.</span><span style="color:#B392F0;">createReadStream</span><span style="color:#E1E4E8;">(path.</span><span style="color:#B392F0;">resolve</span><span style="color:#E1E4E8;">(rootPath, </span><span style="color:#9ECBFF;">&quot;./01.mp4&quot;</span><span style="color:#E1E4E8;">), {</span></span>
<span class="line"><span style="color:#E1E4E8;">  highWaterMark: </span><span style="color:#79B8FF;">1024</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1024</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">});</span></span>
<span class="line"><span style="color:#6A737D;">// rs.pipe(res); rs.pipe的原理就是下面的代码，每次有数据流过就通过管道写入到res流中</span></span>
<span class="line"><span style="color:#E1E4E8;">rs.</span><span style="color:#B392F0;">on</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;data&quot;</span><span style="color:#E1E4E8;">, (</span><span style="color:#FFAB70;">chunk</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;">// 每次读取数据就将数据响应给客户端</span></span>
<span class="line"><span style="color:#E1E4E8;">  res.</span><span style="color:#B392F0;">write</span><span style="color:#E1E4E8;">(chunk);</span></span>
<span class="line"><span style="color:#E1E4E8;">});</span></span>
<span class="line"><span style="color:#6A737D;">// 读取完成，结束HTTP传输。</span></span>
<span class="line"><span style="color:#E1E4E8;">rs.</span><span style="color:#B392F0;">on</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;end&quot;</span><span style="color:#E1E4E8;">, () </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> res.</span><span style="color:#B392F0;">end</span><span style="color:#E1E4E8;">());</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">// 每次读取1mb的数据</span></span>
<span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">rs</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> fs.</span><span style="color:#6F42C1;">createReadStream</span><span style="color:#24292E;">(path.</span><span style="color:#6F42C1;">resolve</span><span style="color:#24292E;">(rootPath, </span><span style="color:#032F62;">&quot;./01.mp4&quot;</span><span style="color:#24292E;">), {</span></span>
<span class="line"><span style="color:#24292E;">  highWaterMark: </span><span style="color:#005CC5;">1024</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">*</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1024</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">});</span></span>
<span class="line"><span style="color:#6A737D;">// rs.pipe(res); rs.pipe的原理就是下面的代码，每次有数据流过就通过管道写入到res流中</span></span>
<span class="line"><span style="color:#24292E;">rs.</span><span style="color:#6F42C1;">on</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;data&quot;</span><span style="color:#24292E;">, (</span><span style="color:#E36209;">chunk</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6A737D;">// 每次读取数据就将数据响应给客户端</span></span>
<span class="line"><span style="color:#24292E;">  res.</span><span style="color:#6F42C1;">write</span><span style="color:#24292E;">(chunk);</span></span>
<span class="line"><span style="color:#24292E;">});</span></span>
<span class="line"><span style="color:#6A737D;">// 读取完成，结束HTTP传输。</span></span>
<span class="line"><span style="color:#24292E;">rs.</span><span style="color:#6F42C1;">on</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;end&quot;</span><span style="color:#24292E;">, () </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> res.</span><span style="color:#6F42C1;">end</span><span style="color:#24292E;">());</span></span></code></pre></div><p>全部：</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">// 读取文件长度，让前端知道文件总大小</span></span>
<span class="line"><span style="color:#E1E4E8;">fs.</span><span style="color:#B392F0;">stat</span><span style="color:#E1E4E8;">(path.</span><span style="color:#B392F0;">resolve</span><span style="color:#E1E4E8;">(rootPath, </span><span style="color:#9ECBFF;">&quot;./01.mp4&quot;</span><span style="color:#E1E4E8;">), (</span><span style="color:#FFAB70;">err</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">stats</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (err) {</span></span>
<span class="line"><span style="color:#E1E4E8;">    res.statusCode </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">500</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">    res.</span><span style="color:#B392F0;">end</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;error&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">  }</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;">// 返回文件总大小,前端可以知道传输的进度</span></span>
<span class="line"><span style="color:#E1E4E8;">  res.</span><span style="color:#B392F0;">setHeader</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;Content-Length&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#B392F0;">String</span><span style="color:#E1E4E8;">(stats.size));</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;">// 每次读取1mb的数据</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">rs</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> fs.</span><span style="color:#B392F0;">createReadStream</span><span style="color:#E1E4E8;">(path.</span><span style="color:#B392F0;">resolve</span><span style="color:#E1E4E8;">(rootPath, </span><span style="color:#9ECBFF;">&quot;./01.mp4&quot;</span><span style="color:#E1E4E8;">), {</span></span>
<span class="line"><span style="color:#E1E4E8;">    highWaterMark: </span><span style="color:#79B8FF;">1024</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1024</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">  });</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;">// rs.pipe(res);</span></span>
<span class="line"><span style="color:#E1E4E8;">  rs.</span><span style="color:#B392F0;">on</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;data&quot;</span><span style="color:#E1E4E8;">, (</span><span style="color:#FFAB70;">chunk</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">    res.</span><span style="color:#B392F0;">write</span><span style="color:#E1E4E8;">(chunk);</span></span>
<span class="line"><span style="color:#E1E4E8;">  });</span></span>
<span class="line"><span style="color:#E1E4E8;">  rs.</span><span style="color:#B392F0;">on</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;end&quot;</span><span style="color:#E1E4E8;">, () </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">    res.</span><span style="color:#B392F0;">end</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">  });</span></span>
<span class="line"><span style="color:#E1E4E8;">});</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">// 读取文件长度，让前端知道文件总大小</span></span>
<span class="line"><span style="color:#24292E;">fs.</span><span style="color:#6F42C1;">stat</span><span style="color:#24292E;">(path.</span><span style="color:#6F42C1;">resolve</span><span style="color:#24292E;">(rootPath, </span><span style="color:#032F62;">&quot;./01.mp4&quot;</span><span style="color:#24292E;">), (</span><span style="color:#E36209;">err</span><span style="color:#24292E;">, </span><span style="color:#E36209;">stats</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (err) {</span></span>
<span class="line"><span style="color:#24292E;">    res.statusCode </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">500</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">    res.</span><span style="color:#6F42C1;">end</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;error&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">return</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">  }</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6A737D;">// 返回文件总大小,前端可以知道传输的进度</span></span>
<span class="line"><span style="color:#24292E;">  res.</span><span style="color:#6F42C1;">setHeader</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;Content-Length&quot;</span><span style="color:#24292E;">, </span><span style="color:#6F42C1;">String</span><span style="color:#24292E;">(stats.size));</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6A737D;">// 每次读取1mb的数据</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">rs</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> fs.</span><span style="color:#6F42C1;">createReadStream</span><span style="color:#24292E;">(path.</span><span style="color:#6F42C1;">resolve</span><span style="color:#24292E;">(rootPath, </span><span style="color:#032F62;">&quot;./01.mp4&quot;</span><span style="color:#24292E;">), {</span></span>
<span class="line"><span style="color:#24292E;">    highWaterMark: </span><span style="color:#005CC5;">1024</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">*</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1024</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">  });</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6A737D;">// rs.pipe(res);</span></span>
<span class="line"><span style="color:#24292E;">  rs.</span><span style="color:#6F42C1;">on</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;data&quot;</span><span style="color:#24292E;">, (</span><span style="color:#E36209;">chunk</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">    res.</span><span style="color:#6F42C1;">write</span><span style="color:#24292E;">(chunk);</span></span>
<span class="line"><span style="color:#24292E;">  });</span></span>
<span class="line"><span style="color:#24292E;">  rs.</span><span style="color:#6F42C1;">on</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;end&quot;</span><span style="color:#24292E;">, () </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">    res.</span><span style="color:#6F42C1;">end</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">  });</span></span>
<span class="line"><span style="color:#24292E;">});</span></span></code></pre></div><h4 id="对比流和直接读取" tabindex="-1">对比流和直接读取 <a class="header-anchor" href="#对比流和直接读取" aria-label="Permalink to &quot;对比流和直接读取&quot;">​</a></h4><p>我们使用 apache 工具来测试<a href="https://cloud.tencent.com/developer/article/1698069" target="_blank" rel="noreferrer">安装教程</a>，安装完成后运行命令<code>ab -n 100 -c 100 http://localhost:8000/01.mp4</code>，其中<code>-n 100</code>表示先后发送 100 次请求，<code>-c 100</code>表示一次性发送的请求数目为 100 个。对比结果分析使用 stream 后，有非常大的性能提升。</p><h3 id="_1-目标流" tabindex="-1">1.目标流 <a class="header-anchor" href="#_1-目标流" aria-label="Permalink to &quot;1.目标流&quot;">​</a></h3><p>​ <code>stream</code>也就是容器，存放着数据。通过管道将数据流向另一个容器里面。</p><p>如何创建流？</p><ol><li>从控制台输入</li><li>http 请求中的上下文都是流数据，<code>request</code>可以传输请求体数据、<code>response</code>可以传输响应体数据，<code>request</code>是 src 流，<code>response</code>是 dest 流。</li><li>读取文件<code>createReadFile</code>。</li></ol><p><code>stream</code>对象可以监听<code>&quot;data&quot;</code>,<code>&quot;end&quot;</code>,<code>&quot;open&quot;</code>,<code>&quot;close&quot;</code>,<code>&quot;error&quot;</code>等事件。<code>node.js</code>中监听自定义事件使用<code>.on</code>方法，例如<code>process.stdin.on(‘data’,…)</code>, <code>req.on(‘data’,…)</code>,通过这种方式，能很直观的监听到<code>stream</code>数据的传入和结束。</p><h3 id="_2-管道-pipe" tabindex="-1">2.管道 pipe <a class="header-anchor" href="#_2-管道-pipe" aria-label="Permalink to &quot;2.管道 pipe&quot;">​</a></h3><p>​ 管道 pipe 可以让容器中的数据流向另一个容器中。</p><p>​ <code>pipe</code>只能将<strong>可读流</strong>数据通过管道流向<strong>可写流</strong>。它会自动处理数据的传输和流的控制，无需手动编写数据的读取和写入逻辑。通过 <code>pipe</code> 方法，可以方便地实现将数据从一个流传输到另一个流的功能。</p><p>​ 其 pipe 原理就是:</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">rs</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> fs.</span><span style="color:#B392F0;">createReadStream</span><span style="color:#E1E4E8;">(src_path);</span></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">ws</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> fs.</span><span style="color:#B392F0;">createWriteStream</span><span style="color:#E1E4E8;">(dest_path);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// 每次有数据流过就写入到可写流中</span></span>
<span class="line"><span style="color:#E1E4E8;">rs.</span><span style="color:#B392F0;">on</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;data&quot;</span><span style="color:#E1E4E8;">, (</span><span style="color:#FFAB70;">chunk</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> ws.</span><span style="color:#B392F0;">write</span><span style="color:#E1E4E8;">(chunk));</span></span>
<span class="line"><span style="color:#6A737D;">// 读取完成</span></span>
<span class="line"><span style="color:#E1E4E8;">rs.</span><span style="color:#B392F0;">on</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;end&quot;</span><span style="color:#E1E4E8;">, () </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;">// 关闭文件</span></span>
<span class="line"><span style="color:#E1E4E8;">  ws.</span><span style="color:#B392F0;">close</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">  rs.</span><span style="color:#B392F0;">close</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">});</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">rs</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> fs.</span><span style="color:#6F42C1;">createReadStream</span><span style="color:#24292E;">(src_path);</span></span>
<span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">ws</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> fs.</span><span style="color:#6F42C1;">createWriteStream</span><span style="color:#24292E;">(dest_path);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// 每次有数据流过就写入到可写流中</span></span>
<span class="line"><span style="color:#24292E;">rs.</span><span style="color:#6F42C1;">on</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;data&quot;</span><span style="color:#24292E;">, (</span><span style="color:#E36209;">chunk</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> ws.</span><span style="color:#6F42C1;">write</span><span style="color:#24292E;">(chunk));</span></span>
<span class="line"><span style="color:#6A737D;">// 读取完成</span></span>
<span class="line"><span style="color:#24292E;">rs.</span><span style="color:#6F42C1;">on</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;end&quot;</span><span style="color:#24292E;">, () </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6A737D;">// 关闭文件</span></span>
<span class="line"><span style="color:#24292E;">  ws.</span><span style="color:#6F42C1;">close</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">  rs.</span><span style="color:#6F42C1;">close</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">});</span></span></code></pre></div><h3 id="_3-目标流" tabindex="-1">3.目标流 <a class="header-anchor" href="#_3-目标流" aria-label="Permalink to &quot;3.目标流&quot;">​</a></h3><p>stream 的输出方式:</p><ol><li>输出控制台</li><li><code>http</code>请求中的<code>response</code></li><li>写入文件<code>createWriteFile</code></li></ol><h3 id="_4-stream-的应用场景" tabindex="-1">4.stream 的应用场景 <a class="header-anchor" href="#_4-stream-的应用场景" aria-label="Permalink to &quot;4.stream 的应用场景&quot;">​</a></h3><p>​ <code>stream</code>主要就是用来处理<code>IO操作</code>的，而文件操作、网络传输都属于输入输出流。（网络传输需要接受和响应）。<code>stream</code>的本质——由于一次性<code>IO</code>操作过大，硬件开销太多，影响软件运行效率，因此将<code>IO</code>分批分段进行操作，让数据像水管一样流动起来，直到流动完成，也就是操作完成。</p><h3 id="_0-通过-stream-合并文件-可以优化为递归" tabindex="-1">0.通过 stream 合并文件(可以优化为递归) <a class="header-anchor" href="#_0-通过-stream-合并文件-可以优化为递归" aria-label="Permalink to &quot;0.通过 stream 合并文件(可以优化为递归)&quot;">​</a></h3><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">path</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">require</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;path&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">fs</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">require</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;fs&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">rootPath</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> path.</span><span style="color:#B392F0;">resolve</span><span style="color:#E1E4E8;">(__dirname, </span><span style="color:#9ECBFF;">&quot;../test&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">rs01</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> fs.</span><span style="color:#B392F0;">createReadStream</span><span style="color:#E1E4E8;">(path.</span><span style="color:#B392F0;">resolve</span><span style="color:#E1E4E8;">(rootPath, </span><span style="color:#9ECBFF;">&quot;./02.txt&quot;</span><span style="color:#E1E4E8;">), </span><span style="color:#9ECBFF;">&quot;utf-8&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// 读取文件总长度</span></span>
<span class="line"><span style="color:#F97583;">let</span><span style="color:#E1E4E8;"> readSize </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#6A737D;">// 创建可写流1将rs01文件内容写入到目标文件中</span></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">ws01</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> fs.</span><span style="color:#B392F0;">createWriteStream</span><span style="color:#E1E4E8;">(path.</span><span style="color:#B392F0;">resolve</span><span style="color:#E1E4E8;">(rootPath, </span><span style="color:#9ECBFF;">&quot;./03.txt&quot;</span><span style="color:#E1E4E8;">), {</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;">// 写入文件的起始位置</span></span>
<span class="line"><span style="color:#E1E4E8;">  start: readSize,</span></span>
<span class="line"><span style="color:#E1E4E8;">  encoding: </span><span style="color:#9ECBFF;">&quot;utf-8&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">});</span></span>
<span class="line"><span style="color:#6A737D;">// rs01传输数据</span></span>
<span class="line"><span style="color:#E1E4E8;">rs01.</span><span style="color:#B392F0;">on</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;data&quot;</span><span style="color:#E1E4E8;">, (</span><span style="color:#FFAB70;">chunk</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">  readSize </span><span style="color:#F97583;">+=</span><span style="color:#E1E4E8;"> chunk.</span><span style="color:#79B8FF;">length</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;">// 将流式数据写入到目标文件里</span></span>
<span class="line"><span style="color:#E1E4E8;">  ws01.</span><span style="color:#B392F0;">write</span><span style="color:#E1E4E8;">(chunk);</span></span>
<span class="line"><span style="color:#E1E4E8;">});</span></span>
<span class="line"><span style="color:#6A737D;">// rs01传输完成</span></span>
<span class="line"><span style="color:#E1E4E8;">rs01.</span><span style="color:#B392F0;">on</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;end&quot;</span><span style="color:#E1E4E8;">, () </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;">//  关闭可写流01</span></span>
<span class="line"><span style="color:#E1E4E8;">  ws01.</span><span style="color:#B392F0;">close</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;">// 开始读取文件02</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">rs02</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> fs.</span><span style="color:#B392F0;">createReadStream</span><span style="color:#E1E4E8;">(path.</span><span style="color:#B392F0;">resolve</span><span style="color:#E1E4E8;">(rootPath, </span><span style="color:#9ECBFF;">&quot;./01.txt&quot;</span><span style="color:#E1E4E8;">), </span><span style="color:#9ECBFF;">&quot;utf-8&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;">// 创建可写流02</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">ws02</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> fs.</span><span style="color:#B392F0;">createWriteStream</span><span style="color:#E1E4E8;">(path.</span><span style="color:#B392F0;">resolve</span><span style="color:#E1E4E8;">(rootPath, </span><span style="color:#9ECBFF;">&quot;./03.txt&quot;</span><span style="color:#E1E4E8;">), {</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">// 设置写入的起始位置</span></span>
<span class="line"><span style="color:#E1E4E8;">    start: readSize,</span></span>
<span class="line"><span style="color:#E1E4E8;">    encoding: </span><span style="color:#9ECBFF;">&quot;utf-8&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">// 设置标志位为追加，不然会重新创建文件</span></span>
<span class="line"><span style="color:#E1E4E8;">    flags: </span><span style="color:#9ECBFF;">&quot;a&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">  });</span></span>
<span class="line"><span style="color:#E1E4E8;">  rs02.</span><span style="color:#B392F0;">on</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;data&quot;</span><span style="color:#E1E4E8;">, (</span><span style="color:#FFAB70;">chunk</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">    readSize </span><span style="color:#F97583;">+=</span><span style="color:#E1E4E8;"> chunk.</span><span style="color:#79B8FF;">length</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">    ws02.</span><span style="color:#B392F0;">write</span><span style="color:#E1E4E8;">(chunk);</span></span>
<span class="line"><span style="color:#E1E4E8;">  });</span></span>
<span class="line"><span style="color:#E1E4E8;">  rs02.</span><span style="color:#B392F0;">on</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;end&quot;</span><span style="color:#E1E4E8;">, () </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">    console.</span><span style="color:#B392F0;">log</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;合并总长度为:&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> readSize);</span></span>
<span class="line"><span style="color:#E1E4E8;">  });</span></span>
<span class="line"><span style="color:#E1E4E8;">});</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">path</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">require</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;path&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">fs</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">require</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;fs&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">rootPath</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> path.</span><span style="color:#6F42C1;">resolve</span><span style="color:#24292E;">(__dirname, </span><span style="color:#032F62;">&quot;../test&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">rs01</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> fs.</span><span style="color:#6F42C1;">createReadStream</span><span style="color:#24292E;">(path.</span><span style="color:#6F42C1;">resolve</span><span style="color:#24292E;">(rootPath, </span><span style="color:#032F62;">&quot;./02.txt&quot;</span><span style="color:#24292E;">), </span><span style="color:#032F62;">&quot;utf-8&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// 读取文件总长度</span></span>
<span class="line"><span style="color:#D73A49;">let</span><span style="color:#24292E;"> readSize </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#6A737D;">// 创建可写流1将rs01文件内容写入到目标文件中</span></span>
<span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">ws01</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> fs.</span><span style="color:#6F42C1;">createWriteStream</span><span style="color:#24292E;">(path.</span><span style="color:#6F42C1;">resolve</span><span style="color:#24292E;">(rootPath, </span><span style="color:#032F62;">&quot;./03.txt&quot;</span><span style="color:#24292E;">), {</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6A737D;">// 写入文件的起始位置</span></span>
<span class="line"><span style="color:#24292E;">  start: readSize,</span></span>
<span class="line"><span style="color:#24292E;">  encoding: </span><span style="color:#032F62;">&quot;utf-8&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">});</span></span>
<span class="line"><span style="color:#6A737D;">// rs01传输数据</span></span>
<span class="line"><span style="color:#24292E;">rs01.</span><span style="color:#6F42C1;">on</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;data&quot;</span><span style="color:#24292E;">, (</span><span style="color:#E36209;">chunk</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">  readSize </span><span style="color:#D73A49;">+=</span><span style="color:#24292E;"> chunk.</span><span style="color:#005CC5;">length</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6A737D;">// 将流式数据写入到目标文件里</span></span>
<span class="line"><span style="color:#24292E;">  ws01.</span><span style="color:#6F42C1;">write</span><span style="color:#24292E;">(chunk);</span></span>
<span class="line"><span style="color:#24292E;">});</span></span>
<span class="line"><span style="color:#6A737D;">// rs01传输完成</span></span>
<span class="line"><span style="color:#24292E;">rs01.</span><span style="color:#6F42C1;">on</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;end&quot;</span><span style="color:#24292E;">, () </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6A737D;">//  关闭可写流01</span></span>
<span class="line"><span style="color:#24292E;">  ws01.</span><span style="color:#6F42C1;">close</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6A737D;">// 开始读取文件02</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">rs02</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> fs.</span><span style="color:#6F42C1;">createReadStream</span><span style="color:#24292E;">(path.</span><span style="color:#6F42C1;">resolve</span><span style="color:#24292E;">(rootPath, </span><span style="color:#032F62;">&quot;./01.txt&quot;</span><span style="color:#24292E;">), </span><span style="color:#032F62;">&quot;utf-8&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6A737D;">// 创建可写流02</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">ws02</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> fs.</span><span style="color:#6F42C1;">createWriteStream</span><span style="color:#24292E;">(path.</span><span style="color:#6F42C1;">resolve</span><span style="color:#24292E;">(rootPath, </span><span style="color:#032F62;">&quot;./03.txt&quot;</span><span style="color:#24292E;">), {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">// 设置写入的起始位置</span></span>
<span class="line"><span style="color:#24292E;">    start: readSize,</span></span>
<span class="line"><span style="color:#24292E;">    encoding: </span><span style="color:#032F62;">&quot;utf-8&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">// 设置标志位为追加，不然会重新创建文件</span></span>
<span class="line"><span style="color:#24292E;">    flags: </span><span style="color:#032F62;">&quot;a&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">  });</span></span>
<span class="line"><span style="color:#24292E;">  rs02.</span><span style="color:#6F42C1;">on</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;data&quot;</span><span style="color:#24292E;">, (</span><span style="color:#E36209;">chunk</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">    readSize </span><span style="color:#D73A49;">+=</span><span style="color:#24292E;"> chunk.</span><span style="color:#005CC5;">length</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">    ws02.</span><span style="color:#6F42C1;">write</span><span style="color:#24292E;">(chunk);</span></span>
<span class="line"><span style="color:#24292E;">  });</span></span>
<span class="line"><span style="color:#24292E;">  rs02.</span><span style="color:#6F42C1;">on</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;end&quot;</span><span style="color:#24292E;">, () </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">    console.</span><span style="color:#6F42C1;">log</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;合并总长度为:&quot;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> readSize);</span></span>
<span class="line"><span style="color:#24292E;">  });</span></span>
<span class="line"><span style="color:#24292E;">});</span></span></code></pre></div><h3 id="_5-文件的可读可写流" tabindex="-1">5.文件的可读可写流 <a class="header-anchor" href="#_5-文件的可读可写流" aria-label="Permalink to &quot;5.文件的可读可写流&quot;">​</a></h3><p><a href="https://juejin.cn/post/6844903681255538695#heading-6" target="_blank" rel="noreferrer">https://juejin.cn/post/6844903681255538695#heading-6</a></p><h4 id="_5-1createreadstream" tabindex="-1">5.1createReadStream <a class="header-anchor" href="#_5-1createreadstream" aria-label="Permalink to &quot;5.1createReadStream&quot;">​</a></h4><p>​ 创建可读流<code>createReadStream</code> 方法有两个参数，第一个参数是读取文件的路径，第二个参数为 <code>options</code> 选项，其中有八个参数：</p><ul><li>flags：标识位，默认为 <code>r</code>；</li><li>encoding：字符编码，默认为 <code>null</code>；</li><li>fd：文件描述符，默认为 <code>null</code>；</li><li>mode：权限位，默认为 <code>0o666</code>；</li><li>autoClose：是否自动关闭文件，默认为 <code>true</code>；</li><li>start：读取文件的起始位置；</li><li>end：读取文件的（包含）结束位置；</li><li>highWaterMark：最大读取文件的字节数，默认 <code>64 * 1024</code>。</li></ul><p><code>createReadStream</code> 的返回值为 <code>fs.ReadStream</code> 对象，读取文件的数据在不指定 <code>encoding</code> 时，默认为 Buffer。</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">rs</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> fs.</span><span style="color:#B392F0;">createReadStream</span><span style="color:#E1E4E8;">(path.</span><span style="color:#B392F0;">resolve</span><span style="color:#E1E4E8;">(__dirname, </span><span style="color:#9ECBFF;">&quot;../test/PCR.mp4&quot;</span><span style="color:#E1E4E8;">));</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">rs.</span><span style="color:#B392F0;">on</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;open&quot;</span><span style="color:#E1E4E8;">, (</span><span style="color:#FFAB70;">fd</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">  console.</span><span style="color:#B392F0;">log</span><span style="color:#E1E4E8;">(fd);</span></span>
<span class="line"><span style="color:#E1E4E8;">});</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">rs.</span><span style="color:#B392F0;">on</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;close&quot;</span><span style="color:#E1E4E8;">, () </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">  console.</span><span style="color:#B392F0;">log</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;关闭文件！&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">});</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">rs</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> fs.</span><span style="color:#6F42C1;">createReadStream</span><span style="color:#24292E;">(path.</span><span style="color:#6F42C1;">resolve</span><span style="color:#24292E;">(__dirname, </span><span style="color:#032F62;">&quot;../test/PCR.mp4&quot;</span><span style="color:#24292E;">));</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">rs.</span><span style="color:#6F42C1;">on</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;open&quot;</span><span style="color:#24292E;">, (</span><span style="color:#E36209;">fd</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">  console.</span><span style="color:#6F42C1;">log</span><span style="color:#24292E;">(fd);</span></span>
<span class="line"><span style="color:#24292E;">});</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">rs.</span><span style="color:#6F42C1;">on</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;close&quot;</span><span style="color:#24292E;">, () </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">  console.</span><span style="color:#6F42C1;">log</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;关闭文件！&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">});</span></span></code></pre></div><h5 id="注意" tabindex="-1"><strong>注意</strong> <a class="header-anchor" href="#注意" aria-label="Permalink to &quot;**注意**&quot;">​</a></h5><p>1.在创建可读流后默认是不会读取文件内容的，读取文件时，可读流有两种状态，暂停状态和流动状态。</p><p>2.如果注册了<code>&quot;data&quot;</code>事件监听，就会持续读取文件了，每次读取文件时都会执行<code>data</code>事件回调。</p><p>3.在读取完成时会调用<code>end</code>事件。</p><p>4.创建可读流时会触发<code>open</code>事件。</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">rs</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> fs.</span><span style="color:#B392F0;">createReadStream</span><span style="color:#E1E4E8;">(path.</span><span style="color:#B392F0;">resolve</span><span style="color:#E1E4E8;">(__dirname, </span><span style="color:#9ECBFF;">&quot;../test/01.txt&quot;</span><span style="color:#E1E4E8;">));</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">rs.</span><span style="color:#B392F0;">on</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;open&quot;</span><span style="color:#E1E4E8;">, (</span><span style="color:#FFAB70;">fd</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">  console.</span><span style="color:#B392F0;">log</span><span style="color:#E1E4E8;">(fd);</span></span>
<span class="line"><span style="color:#E1E4E8;">});</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// 注册了data事件就会自动读取文件了。</span></span>
<span class="line"><span style="color:#E1E4E8;">rs.</span><span style="color:#B392F0;">on</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;data&quot;</span><span style="color:#E1E4E8;">, (</span><span style="color:#FFAB70;">chunk</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">  console.</span><span style="color:#B392F0;">log</span><span style="color:#E1E4E8;">(chunk.</span><span style="color:#B392F0;">toString</span><span style="color:#E1E4E8;">());</span></span>
<span class="line"><span style="color:#E1E4E8;">});</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">rs.</span><span style="color:#B392F0;">on</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;close&quot;</span><span style="color:#E1E4E8;">, () </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">  console.</span><span style="color:#B392F0;">log</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;关闭文件！&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">});</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">rs</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> fs.</span><span style="color:#6F42C1;">createReadStream</span><span style="color:#24292E;">(path.</span><span style="color:#6F42C1;">resolve</span><span style="color:#24292E;">(__dirname, </span><span style="color:#032F62;">&quot;../test/01.txt&quot;</span><span style="color:#24292E;">));</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">rs.</span><span style="color:#6F42C1;">on</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;open&quot;</span><span style="color:#24292E;">, (</span><span style="color:#E36209;">fd</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">  console.</span><span style="color:#6F42C1;">log</span><span style="color:#24292E;">(fd);</span></span>
<span class="line"><span style="color:#24292E;">});</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// 注册了data事件就会自动读取文件了。</span></span>
<span class="line"><span style="color:#24292E;">rs.</span><span style="color:#6F42C1;">on</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;data&quot;</span><span style="color:#24292E;">, (</span><span style="color:#E36209;">chunk</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">  console.</span><span style="color:#6F42C1;">log</span><span style="color:#24292E;">(chunk.</span><span style="color:#6F42C1;">toString</span><span style="color:#24292E;">());</span></span>
<span class="line"><span style="color:#24292E;">});</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">rs.</span><span style="color:#6F42C1;">on</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;close&quot;</span><span style="color:#24292E;">, () </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">  console.</span><span style="color:#6F42C1;">log</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;关闭文件！&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">});</span></span></code></pre></div><h5 id="流动状态" tabindex="-1">流动状态 <a class="header-anchor" href="#流动状态" aria-label="Permalink to &quot;流动状态&quot;">​</a></h5><p>​ 流动状态是指只要可读流开始读取文件后，就会一直不停的读取单位长度（<code>highWaterMark</code>）的数据，就像水龙头一样，直到容器里没水（数据）了才会停止。每次读取文件都会触发<code>data</code>事件，执行 data 事件注册的回调。</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">rs</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> fs.</span><span style="color:#B392F0;">createReadStream</span><span style="color:#E1E4E8;">(path.</span><span style="color:#B392F0;">resolve</span><span style="color:#E1E4E8;">(__dirname, </span><span style="color:#9ECBFF;">&quot;../test/01.txt&quot;</span><span style="color:#E1E4E8;">), {</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;">// 每次读取3个字节的内容</span></span>
<span class="line"><span style="color:#E1E4E8;">  highWaterMark: </span><span style="color:#79B8FF;">3</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;">// 每次读取的数据将其转换成utf-8的编码格式的字符串</span></span>
<span class="line"><span style="color:#E1E4E8;">  encoding: </span><span style="color:#9ECBFF;">&quot;utf-8&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">  start: </span><span style="color:#79B8FF;">6</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">  end: </span><span style="color:#79B8FF;">11</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">});</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// 注册了data事件就会读取文件了。</span></span>
<span class="line"><span style="color:#E1E4E8;">rs.</span><span style="color:#B392F0;">on</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;data&quot;</span><span style="color:#E1E4E8;">, (</span><span style="color:#FFAB70;">chunk</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">  console.</span><span style="color:#B392F0;">log</span><span style="color:#E1E4E8;">(chunk);</span></span>
<span class="line"><span style="color:#E1E4E8;">});</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">rs</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> fs.</span><span style="color:#6F42C1;">createReadStream</span><span style="color:#24292E;">(path.</span><span style="color:#6F42C1;">resolve</span><span style="color:#24292E;">(__dirname, </span><span style="color:#032F62;">&quot;../test/01.txt&quot;</span><span style="color:#24292E;">), {</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6A737D;">// 每次读取3个字节的内容</span></span>
<span class="line"><span style="color:#24292E;">  highWaterMark: </span><span style="color:#005CC5;">3</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6A737D;">// 每次读取的数据将其转换成utf-8的编码格式的字符串</span></span>
<span class="line"><span style="color:#24292E;">  encoding: </span><span style="color:#032F62;">&quot;utf-8&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">  start: </span><span style="color:#005CC5;">6</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">  end: </span><span style="color:#005CC5;">11</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">});</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// 注册了data事件就会读取文件了。</span></span>
<span class="line"><span style="color:#24292E;">rs.</span><span style="color:#6F42C1;">on</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;data&quot;</span><span style="color:#24292E;">, (</span><span style="color:#E36209;">chunk</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">  console.</span><span style="color:#6F42C1;">log</span><span style="color:#24292E;">(chunk);</span></span>
<span class="line"><span style="color:#24292E;">});</span></span></code></pre></div><h5 id="暂停状态" tabindex="-1">暂停状态 <a class="header-anchor" href="#暂停状态" aria-label="Permalink to &quot;暂停状态&quot;">​</a></h5><p>​ <code>ReadStream</code>在默认情况下只要开始读取文件，就会一直按照<code>highWaterMark</code>长度的读取数据，直到读取完全部数据。当前我们也可以手动调用<code>pause</code>方法让<code>ReadStream</code>暂停，暂停之后，<code>ReadStream</code>就不会再读取数据直到我们手动调用<code>resume</code>方法恢复读取。</p><p>​ pause 关闭水龙头，流式数据不再传输数据。</p><p>​ resume 开启水龙头，流式数据继续传输剩余数据。</p><p>每秒读取一次数据。</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">rs</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> fs.</span><span style="color:#B392F0;">createReadStream</span><span style="color:#E1E4E8;">(path.</span><span style="color:#B392F0;">resolve</span><span style="color:#E1E4E8;">(__dirname, </span><span style="color:#9ECBFF;">&quot;../test/01.txt&quot;</span><span style="color:#E1E4E8;">), {</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;">// 每次读取3个字节的内容</span></span>
<span class="line"><span style="color:#E1E4E8;">  highWaterMark: </span><span style="color:#79B8FF;">3</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;">// 每次读取的数据将其转换成utf-8的编码格式的字符串</span></span>
<span class="line"><span style="color:#E1E4E8;">  encoding: </span><span style="color:#9ECBFF;">&quot;utf-8&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">});</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// 注册了data事件就会读取文件了。</span></span>
<span class="line"><span style="color:#E1E4E8;">rs.</span><span style="color:#B392F0;">on</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;data&quot;</span><span style="color:#E1E4E8;">, (</span><span style="color:#FFAB70;">chunk</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">  console.</span><span style="color:#B392F0;">log</span><span style="color:#E1E4E8;">(chunk);</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;">// 暂停读取，关闭水龙头</span></span>
<span class="line"><span style="color:#E1E4E8;">  rs.</span><span style="color:#B392F0;">pause</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">setTimeout</span><span style="color:#E1E4E8;">(() </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">// 恢复读取，重新读取数据</span></span>
<span class="line"><span style="color:#E1E4E8;">    rs.</span><span style="color:#B392F0;">resume</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">  }, </span><span style="color:#79B8FF;">1000</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">});</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">rs.</span><span style="color:#B392F0;">on</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;close&quot;</span><span style="color:#E1E4E8;">, () </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">  console.</span><span style="color:#B392F0;">log</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;关闭文件！&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">});</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">rs</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> fs.</span><span style="color:#6F42C1;">createReadStream</span><span style="color:#24292E;">(path.</span><span style="color:#6F42C1;">resolve</span><span style="color:#24292E;">(__dirname, </span><span style="color:#032F62;">&quot;../test/01.txt&quot;</span><span style="color:#24292E;">), {</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6A737D;">// 每次读取3个字节的内容</span></span>
<span class="line"><span style="color:#24292E;">  highWaterMark: </span><span style="color:#005CC5;">3</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6A737D;">// 每次读取的数据将其转换成utf-8的编码格式的字符串</span></span>
<span class="line"><span style="color:#24292E;">  encoding: </span><span style="color:#032F62;">&quot;utf-8&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">});</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// 注册了data事件就会读取文件了。</span></span>
<span class="line"><span style="color:#24292E;">rs.</span><span style="color:#6F42C1;">on</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;data&quot;</span><span style="color:#24292E;">, (</span><span style="color:#E36209;">chunk</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">  console.</span><span style="color:#6F42C1;">log</span><span style="color:#24292E;">(chunk);</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6A737D;">// 暂停读取，关闭水龙头</span></span>
<span class="line"><span style="color:#24292E;">  rs.</span><span style="color:#6F42C1;">pause</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">setTimeout</span><span style="color:#24292E;">(() </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">// 恢复读取，重新读取数据</span></span>
<span class="line"><span style="color:#24292E;">    rs.</span><span style="color:#6F42C1;">resume</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">  }, </span><span style="color:#005CC5;">1000</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">});</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">rs.</span><span style="color:#6F42C1;">on</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;close&quot;</span><span style="color:#24292E;">, () </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">  console.</span><span style="color:#6F42C1;">log</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;关闭文件！&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">});</span></span></code></pre></div><h5 id="事件" tabindex="-1">事件 <a class="header-anchor" href="#事件" aria-label="Permalink to &quot;事件&quot;">​</a></h5><p>​ 可读流有以下事件监听:</p><p><code>error</code>：错误时的回调。</p><p><code>data</code>：数据读取时的回调。</p><p><code>open</code>：文件打开时的回调。</p><p><code>end</code>：数据读取完成的回调。</p><p><code>close</code>：文件关闭的回调。</p><p><code>pause</code>：暂停读取的回调。</p><p><code>resume</code>：恢复读取的回调。</p><h4 id="_5-2-createwritestream" tabindex="-1">5.2 createWriteStream <a class="header-anchor" href="#_5-2-createwritestream" aria-label="Permalink to &quot;5.2 createWriteStream&quot;">​</a></h4><p>createWriteStream 用来创建可写流，可写流需要通过实例的 end 方法来关闭文件，释放内存。</p><p><code>createWriteStream</code> 方法有两个参数，第一个参数是读取文件的路径，第二个参数为 <code>options</code> 选项，其中有七个参数：</p><ul><li>flags：标识位，默认为 <code>w</code>；</li><li>encoding：字符编码，默认为 <code>utf8</code>；</li><li>fd：文件描述符，默认为 <code>null</code>；</li><li>mode：权限位，默认为 <code>0o666</code>；</li><li>autoClose：是否自动关闭文件，默认为 <code>true</code>；</li><li>start：写入文件的起始位置；</li><li>highWaterMark：一个对比写入字节数的标识，默认 <code>16 * 1024</code>。规定写入数据的长度不能超过该字节长度。</li></ul><p><code>createWriteStream</code> 返回值为 <code>fs.WriteStream</code> 对象。</p><h5 id="_1-write-写入内容" tabindex="-1">1.write 写入内容 <a class="header-anchor" href="#_1-write-写入内容" aria-label="Permalink to &quot;1.write 写入内容&quot;">​</a></h5><p>​ <code>write</code>接受缓冲区数据，将数据写入到可写流中，并写入到对应文件中。</p><p>​ <code>write</code>返回值是一个布尔值，代表 <code>highWaterMark</code> 的值是否足够当前的写入，如果足够，返回 <code>true</code>，否则返回 <code>false</code>，换种说法就是写入内容的长度是否超出了 <code>highWaterMark</code>，超出返回 <code>false</code>。若当前写入内容长度大于等于<code>heighWaterMark</code>则返回 false（超出后依旧可以填充数据），否则返回<code>true</code>。</p><h5 id="_2-drain-吸干事件" tabindex="-1">2.drain 吸干事件 <a class="header-anchor" href="#_2-drain-吸干事件" aria-label="Permalink to &quot;2.drain 吸干事件&quot;">​</a></h5><p>​ <code>drain</code> 意为 “吸干”，当前写入数据的总大小已经大于等于了 <code>highWaterMark</code>，会触发 <code>drain</code> 事件，当写入数据大小大于等于<code>heighWaterMark</code>字节大小就会触发。换句话说，当容器装满溢出时触发。</p><h5 id="_3-end-方法" tabindex="-1">3.end 方法 <a class="header-anchor" href="#_3-end-方法" aria-label="Permalink to &quot;3.end 方法&quot;">​</a></h5><p>​ end 方法，数据将作为最后的内容写入到可写流中，并触发 end 事件，且会关闭文件。</p><h4 id="_5-3-pipe-管道" tabindex="-1">5.3 pipe 管道 <a class="header-anchor" href="#_5-3-pipe-管道" aria-label="Permalink to &quot;5.3 pipe 管道&quot;">​</a></h4><p>​ 有了可读和可写流，如果想要将可读流中的数据写入到可写流可以通过：</p><p>1.创建可读文件流，并将文件中的数据读取出来<code>ReadStream.on(&quot;data&quot;)</code></p><p>2.创建可写流，将读取出来的数通过 write 写入到可写流中。<code>WriteStream.write(data)</code></p><p>上述操作可以简化成<code>ReadSteam.pipe(WriteStream)</code>，可以直接通过 pipe 管道将可读流的数据直接流入到可写流中，不过原理还是同上 1、2 的步骤。</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">rs</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">createReadSteam</span><span style="color:#E1E4E8;">(src_path);</span></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">ws</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">createWriteSteam</span><span style="color:#E1E4E8;">(dest_path);</span></span>
<span class="line"><span style="color:#E1E4E8;">rs.</span><span style="color:#B392F0;">pipe</span><span style="color:#E1E4E8;">(ws); </span><span style="color:#6A737D;">// 将每次读取出来的数据通过write写入。</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">rs</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">createReadSteam</span><span style="color:#24292E;">(src_path);</span></span>
<span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">ws</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">createWriteSteam</span><span style="color:#24292E;">(dest_path);</span></span>
<span class="line"><span style="color:#24292E;">rs.</span><span style="color:#6F42C1;">pipe</span><span style="color:#24292E;">(ws); </span><span style="color:#6A737D;">// 将每次读取出来的数据通过write写入。</span></span></code></pre></div><h4 id="_5-4-复制文件封装" tabindex="-1">5.4 复制文件封装 <a class="header-anchor" href="#_5-4-复制文件封装" aria-label="Permalink to &quot;5.4 复制文件封装&quot;">​</a></h4><p>​ 时间上虽然都差不多，但是内存开销是完全不一样的，直接读取文件会将整个文件读取到内存中，非常占用内存资源，但流式数据就不一样了，每次读取<code>heighWaterMark</code>大小的数据到内存中，只会占用少部分空间，性能开销小。</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">fs</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">require</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;fs&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">path</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">require</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;path&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">rootPath</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> path.</span><span style="color:#B392F0;">resolve</span><span style="color:#E1E4E8;">(__dirname, </span><span style="color:#9ECBFF;">&quot;../test&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">srcPath</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> path.</span><span style="color:#B392F0;">resolve</span><span style="color:#E1E4E8;">(rootPath, </span><span style="color:#9ECBFF;">&quot;./01.mp4&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">destPath</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> path.</span><span style="color:#B392F0;">resolve</span><span style="color:#E1E4E8;">(rootPath, </span><span style="color:#9ECBFF;">&quot;./01_COPY.mp4&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// 通过流式来拷贝180mb的文件</span></span>
<span class="line"><span style="color:#F97583;">function</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">copyStream</span><span style="color:#E1E4E8;">() {</span></span>
<span class="line"><span style="color:#E1E4E8;">  console.</span><span style="color:#B392F0;">time</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">rs</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> fs.</span><span style="color:#B392F0;">createReadStream</span><span style="color:#E1E4E8;">(srcPath);</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">ws</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> fs.</span><span style="color:#B392F0;">createWriteStream</span><span style="color:#E1E4E8;">(destPath);</span></span>
<span class="line"><span style="color:#E1E4E8;">  rs.</span><span style="color:#B392F0;">on</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;data&quot;</span><span style="color:#E1E4E8;">, (</span><span style="color:#FFAB70;">chunk</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">// 每次读取就立即写入到可写流中</span></span>
<span class="line"><span style="color:#E1E4E8;">    ws.</span><span style="color:#B392F0;">write</span><span style="color:#E1E4E8;">(chunk);</span></span>
<span class="line"><span style="color:#E1E4E8;">  });</span></span>
<span class="line"><span style="color:#E1E4E8;">  rs.</span><span style="color:#B392F0;">on</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;end&quot;</span><span style="color:#E1E4E8;">, () </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">    ws.</span><span style="color:#B392F0;">end</span><span style="color:#E1E4E8;">(() </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">      console.</span><span style="color:#B392F0;">timeEnd</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">    });</span></span>
<span class="line"><span style="color:#E1E4E8;">  });</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// 直接拷贝</span></span>
<span class="line"><span style="color:#F97583;">function</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">copy</span><span style="color:#E1E4E8;">() {</span></span>
<span class="line"><span style="color:#E1E4E8;">  console.</span><span style="color:#B392F0;">time</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">data</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> fs.</span><span style="color:#B392F0;">readFileSync</span><span style="color:#E1E4E8;">(srcPath);</span></span>
<span class="line"><span style="color:#E1E4E8;">  fs.</span><span style="color:#B392F0;">writeFileSync</span><span style="color:#E1E4E8;">(destPath, data);</span></span>
<span class="line"><span style="color:#E1E4E8;">  console.</span><span style="color:#B392F0;">timeEnd</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">fs</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">require</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;fs&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">path</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">require</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;path&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">rootPath</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> path.</span><span style="color:#6F42C1;">resolve</span><span style="color:#24292E;">(__dirname, </span><span style="color:#032F62;">&quot;../test&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">srcPath</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> path.</span><span style="color:#6F42C1;">resolve</span><span style="color:#24292E;">(rootPath, </span><span style="color:#032F62;">&quot;./01.mp4&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">destPath</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> path.</span><span style="color:#6F42C1;">resolve</span><span style="color:#24292E;">(rootPath, </span><span style="color:#032F62;">&quot;./01_COPY.mp4&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// 通过流式来拷贝180mb的文件</span></span>
<span class="line"><span style="color:#D73A49;">function</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">copyStream</span><span style="color:#24292E;">() {</span></span>
<span class="line"><span style="color:#24292E;">  console.</span><span style="color:#6F42C1;">time</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">rs</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> fs.</span><span style="color:#6F42C1;">createReadStream</span><span style="color:#24292E;">(srcPath);</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">ws</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> fs.</span><span style="color:#6F42C1;">createWriteStream</span><span style="color:#24292E;">(destPath);</span></span>
<span class="line"><span style="color:#24292E;">  rs.</span><span style="color:#6F42C1;">on</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;data&quot;</span><span style="color:#24292E;">, (</span><span style="color:#E36209;">chunk</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">// 每次读取就立即写入到可写流中</span></span>
<span class="line"><span style="color:#24292E;">    ws.</span><span style="color:#6F42C1;">write</span><span style="color:#24292E;">(chunk);</span></span>
<span class="line"><span style="color:#24292E;">  });</span></span>
<span class="line"><span style="color:#24292E;">  rs.</span><span style="color:#6F42C1;">on</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;end&quot;</span><span style="color:#24292E;">, () </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">    ws.</span><span style="color:#6F42C1;">end</span><span style="color:#24292E;">(() </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">      console.</span><span style="color:#6F42C1;">timeEnd</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">    });</span></span>
<span class="line"><span style="color:#24292E;">  });</span></span>
<span class="line"><span style="color:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// 直接拷贝</span></span>
<span class="line"><span style="color:#D73A49;">function</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">copy</span><span style="color:#24292E;">() {</span></span>
<span class="line"><span style="color:#24292E;">  console.</span><span style="color:#6F42C1;">time</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">data</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> fs.</span><span style="color:#6F42C1;">readFileSync</span><span style="color:#24292E;">(srcPath);</span></span>
<span class="line"><span style="color:#24292E;">  fs.</span><span style="color:#6F42C1;">writeFileSync</span><span style="color:#24292E;">(destPath, data);</span></span>
<span class="line"><span style="color:#24292E;">  console.</span><span style="color:#6F42C1;">timeEnd</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre></div><h1 id="buffer-模块" tabindex="-1">Buffer 模块 <a class="header-anchor" href="#buffer-模块" aria-label="Permalink to &quot;Buffer 模块&quot;">​</a></h1><p><a href="https://zhuanlan.zhihu.com/p/152214266" target="_blank" rel="noreferrer">https://zhuanlan.zhihu.com/p/152214266</a></p><p><a href="https://juejin.cn/post/6844903897438371847#heading-2" target="_blank" rel="noreferrer">https://juejin.cn/post/6844903897438371847#heading-2</a></p><p>流传输的数据起始就是 buffer，buffer 是什么？就是一串串二进制数据，为什么 Node 要操作二进制数据？因为读写文件需要二进制（为什么读文件要二进制，因为不知道文件编码格式，还不如统一成二进制保护源数据）、http 传输是二进制.....</p><h2 id="_1-buffer-创建" tabindex="-1">1.Buffer 创建 <a class="header-anchor" href="#_1-buffer-创建" aria-label="Permalink to &quot;1.Buffer 创建&quot;">​</a></h2><h3 id="_1-1-buffer-alloc" tabindex="-1">1.1 Buffer.alloc <a class="header-anchor" href="#_1-1-buffer-alloc" aria-label="Permalink to &quot;1.1 Buffer.alloc&quot;">​</a></h3><p>​ 传递一个 int 类型的数据，代表分配多少字节的空间给缓冲区，且每个字节的值都被初始化为<code>0x00</code>，一个字节八位，一个字节为两位十六进制组成。</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">buf1</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> Buffer.</span><span style="color:#B392F0;">alloc</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">10</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">buf1; </span><span style="color:#6A737D;">// &lt;Buffer 00 00 00 00 00 00 00 00 00 00 00&gt;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">buf1</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> Buffer.</span><span style="color:#6F42C1;">alloc</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">10</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">buf1; </span><span style="color:#6A737D;">// &lt;Buffer 00 00 00 00 00 00 00 00 00 00 00&gt;</span></span></code></pre></div><h3 id="_1-2-buffer-allocunsafe" tabindex="-1">1.2 Buffer.allocUnSafe <a class="header-anchor" href="#_1-2-buffer-allocunsafe" aria-label="Permalink to &quot;1.2 Buffer.allocUnSafe&quot;">​</a></h3><p>​ 传递一个 int 类型的数据，代表分配多少字节的空间给缓冲区，但<strong>这段缓冲区可能有数据未被初始化</strong>，只要内存中有空余的空间就抓过来使用。但创建速度比<code>alloc</code>快。</p><h3 id="_1-3-buffer-from" tabindex="-1">1.3 Buffer.from <a class="header-anchor" href="#_1-3-buffer-from" aria-label="Permalink to &quot;1.3 Buffer.from&quot;">​</a></h3><p>​ 根据内容创建缓冲区,from 有三种重载：</p><p>1.第一个参数为字符串，第二个参数为字符编码，如 <code>ASCII</code>、<code>UTF-8</code>、<code>Base64</code> 等等。</p><p>2.传入一个数组，数组的每一项会以十六进制存储为 <code>Buffer</code> 的每一项。</p><p>3.传入一个<code>Buffer</code>，会将 <code>Buffer</code> 的每一项作为新返回 <code>Buffer</code> 的每一项。相当于拷贝了一份 buffer 数据</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">buf3</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> Buffer.</span><span style="color:#B392F0;">from</span><span style="color:#E1E4E8;">([</span><span style="color:#79B8FF;">65</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">66</span><span style="color:#E1E4E8;">]); </span><span style="color:#6A737D;">// &lt;Buffer 65 66&gt;</span></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">buf4</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> Buffer.</span><span style="color:#B392F0;">from</span><span style="color:#E1E4E8;">(buf3); </span><span style="color:#6A737D;">// 拷贝了buf3的数据</span></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">buf5</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> Buffer.</span><span style="color:#B392F0;">from</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;你好&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&quot;utf-8&quot;</span><span style="color:#E1E4E8;">); </span><span style="color:#6A737D;">// 以对应编码格式创建二进制数据</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">buf3</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> Buffer.</span><span style="color:#6F42C1;">from</span><span style="color:#24292E;">([</span><span style="color:#005CC5;">65</span><span style="color:#24292E;">, </span><span style="color:#005CC5;">66</span><span style="color:#24292E;">]); </span><span style="color:#6A737D;">// &lt;Buffer 65 66&gt;</span></span>
<span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">buf4</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> Buffer.</span><span style="color:#6F42C1;">from</span><span style="color:#24292E;">(buf3); </span><span style="color:#6A737D;">// 拷贝了buf3的数据</span></span>
<span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">buf5</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> Buffer.</span><span style="color:#6F42C1;">from</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;你好&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;utf-8&quot;</span><span style="color:#24292E;">); </span><span style="color:#6A737D;">// 以对应编码格式创建二进制数据</span></span></code></pre></div><h2 id="_2-实例方法" tabindex="-1">2.实例方法 <a class="header-anchor" href="#_2-实例方法" aria-label="Permalink to &quot;2.实例方法&quot;">​</a></h2><p>​ fill</p><h1 id="path-模块" tabindex="-1">Path 模块 <a class="header-anchor" href="#path-模块" aria-label="Permalink to &quot;Path 模块&quot;">​</a></h1><p>resolve</p><p>join</p><p>basename</p><p>extname</p><h1 id="event-模块" tabindex="-1">Event 模块 <a class="header-anchor" href="#event-模块" aria-label="Permalink to &quot;Event 模块&quot;">​</a></h1><p>​ <strong>EventEmitter</strong>。</p><h1 id="参考" tabindex="-1">参考 <a class="header-anchor" href="#参考" aria-label="Permalink to &quot;参考&quot;">​</a></h1><ol><li><a href="http://nqdeng.github.io/7-days-nodejs/#4.2.1" target="_blank" rel="noreferrer">http://nqdeng.github.io/7-days-nodejs/#4.2.1</a></li><li>​<a href="http://www.inode.club/node" target="_blank" rel="noreferrer">http://www.inode.club/node</a></li></ol></div></div></main><footer class="VPDocFooter" data-v-05ecd897 data-v-905f25ab><!--[--><!--[--><!--[--><!--[--><!----><!--]--><!--]--><!--]--><!--]--><div class="edit-info" data-v-905f25ab><!----><div class="last-updated" data-v-905f25ab><p class="VPLastUpdated" data-v-905f25ab data-v-c5641641>最近更新时间: <time datetime="2023-11-06T13:17:26.000Z" data-v-c5641641></time></p></div></div><nav class="prev-next" data-v-905f25ab><div class="pager" data-v-905f25ab><a class="pager-link prev" href="/note-blog/study/Next.html" data-v-905f25ab><span class="desc" data-v-905f25ab>上一篇</span><span class="title" data-v-905f25ab>Next</span></a></div><div class="pager" data-v-905f25ab><a class="pager-link next" href="/note-blog/study/Nuxt.html" data-v-905f25ab><span class="desc" data-v-905f25ab>下一篇</span><span class="title" data-v-905f25ab>Nuxt</span></a></div></nav></footer><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><!----><!--[--><!--]--></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"interview_html_html5.md\":\"9c0420fb\",\"interview_html.md\":\"caca1d12\",\"interview_html_doctype.md\":\"553bfbe1\",\"interview_html_async-load.md\":\"88940163\",\"index.md\":\"530fe7e1\",\"interview_css_margin-padding.md\":\"d24962f6\",\"interview_css_selector.md\":\"8f6e8fd0\",\"interview_css_containing-block.md\":\"e826a983\",\"interview_js_call-apply-bind.md\":\"6005b5d3\",\"interview_css.md\":\"13046855\",\"guide.md\":\"90170c6a\",\"interview_js_event-loop.md\":\"edc3c394\",\"interview_js_cookie-session-token.md\":\"576df30c\",\"interview_js_async-sync.md\":\"60654c0e\",\"interview_html_src-href.md\":\"65659030\",\"interview_js_module.md\":\"56deaa71\",\"interview.md\":\"480a6f43\",\"question_js_07.md\":\"e1a1cd11\",\"question_js_11.md\":\"3878ed7f\",\"interview_js_prototype.md\":\"49f7321a\",\"question.md\":\"ebcad598\",\"interview_js_copy.md\":\"c49fab46\",\"question_node_05.md\":\"5d090d74\",\"interview_css_bfc.md\":\"89fa4e4d\",\"interview_other.md\":\"8afdd005\",\"interview_js_language.md\":\"eec0b814\",\"interview_js_design-patterns.md\":\"23173411\",\"interview_js_web-storage.md\":\"a899cc67\",\"interview_js.md\":\"435d7d0e\",\"question_js_08.md\":\"784193b0\",\"question_node_02.md\":\"7a155841\",\"question_js_04.md\":\"c040d730\",\"interview_ts.md\":\"9468f2f1\",\"question_html_01.md\":\"14d0058e\",\"interview_css_z-index.md\":\"0ba27ef7\",\"question_css_01.md\":\"e49d4d9e\",\"question_js_05.md\":\"a26a9572\",\"question_js_10.md\":\"f28f60bc\",\"question_node_01.md\":\"e38cb5ed\",\"question_node_06.md\":\"fc7c3455\",\"interview_js_type-conversion.md\":\"79aff1e5\",\"question_node_08.md\":\"8591713f\",\"interview_js_requestanimation.md\":\"d4986650\",\"question_js_12.md\":\"9008c9c2\",\"question_other_05.md\":\"27806f1b\",\"question_js_03.md\":\"e8006992\",\"question_ts_04.md\":\"a845184f\",\"question_vite_01.md\":\"af1648d3\",\"question_ts_03.md\":\"75c8912c\",\"question_node_04.md\":\"ad7d460c\",\"interview_js_cors.md\":\"e2f13e48\",\"interview_js_class.md\":\"450e9ad3\",\"interview_js_element-views.md\":\"8e44cc69\",\"question_vite_03.md\":\"cc1fac95\",\"interview_js_web-worker.md\":\"4704d522\",\"question_other_02.md\":\"0503bc82\",\"study.md\":\"580b47b0\",\"question_html_02.md\":\"1bf045ea\",\"question_js_06.md\":\"d8a08038\",\"question_node_09.md\":\"c83859a2\",\"question_ts_01.md\":\"2a96686f\",\"question_vite_02.md\":\"45e4b3ac\",\"interview_js_var.md\":\"4dba008d\",\"question_node_03.md\":\"93b8cd53\",\"question_vue_06.md\":\"9134da81\",\"question_vue_02.md\":\"2cfefe19\",\"question_ts_02.md\":\"7c883f01\",\"question_vue_07.md\":\"143d40b7\",\"question_js_02.md\":\"880e64c7\",\"question_other_01.md\":\"ef47de5e\",\"question_vue_09.md\":\"6c7e97aa\",\"question_css_02.md\":\"37893315\",\"question_vue_08.md\":\"a977f223\",\"question_vue_13.md\":\"c6a24618\",\"question_vue_03.md\":\"0a575346\",\"question_js_01.md\":\"5d44a274\",\"question_node_07.md\":\"d562a4a3\",\"question_vue_05.md\":\"ed0f449b\",\"interview_js_typeof-instanceof.md\":\"64a00930\",\"question_other_03.md\":\"0d9f884d\",\"study_nuxt.md\":\"63aac670\",\"question_vue_10.md\":\"6f967ae1\",\"question_js_09.md\":\"f07e9d12\",\"question_other_04.md\":\"b20918fe\",\"question_vue_11.md\":\"191cc9f2\",\"question_vue_12.md\":\"b5d27b0d\",\"question_vue_15.md\":\"3dfed57b\",\"question_vue_04.md\":\"f9401872\",\"question_vue_01.md\":\"6852ed91\",\"question_vue_14.md\":\"7ba89fb8\",\"question_vite_04.md\":\"6fcac37f\",\"interview_js_test.md\":\"db0b7b60\",\"study_vitepress.md\":\"c1401f7a\",\"study_node.md\":\"4fadfdf0\",\"study_next.md\":\"8eaf387f\",\"question_node_10.md\":\"39a2ed24\",\"study_nest.md\":\"a6f11113\",\"study_react.md\":\"7835338e\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"en-US\",\"dir\":\"ltr\",\"title\":\"Kinght的小屋\",\"description\":\"A VitePress site\",\"base\":\"/note-blog/\",\"head\":[],\"appearance\":true,\"themeConfig\":{\"lastUpdated\":{},\"search\":{\"provider\":\"local\"},\"lastUpdatedText\":\"最近更新时间\",\"docFooter\":{\"prev\":\"上一篇\",\"next\":\"下一篇\"},\"outline\":\"deep\",\"nav\":[{\"text\":\"开始\",\"link\":\"/guide\"},{\"text\":\"学习\",\"link\":\"/study\"},{\"text\":\"八股\",\"items\":[{\"text\":\"HTML\",\"link\":\"/interview/html\"},{\"text\":\"CSS\",\"link\":\"/interview/css\"},{\"text\":\"JS\",\"link\":\"/interview/js\"},{\"text\":\"TS\",\"link\":\"/interview/ts\"},{\"text\":\"其他\",\"link\":\"/interview/other\"}]},{\"text\":\"踩过的坑\",\"link\":\"/question\"}],\"sidebar\":{\"/study\":[{\"text\":\"Nest\",\"link\":\"/study/Nest\"},{\"text\":\"Next\",\"link\":\"/study/Next\"},{\"text\":\"Node\",\"link\":\"/study/Node\"},{\"text\":\"Nuxt\",\"link\":\"/study/Nuxt\"},{\"text\":\"React\",\"link\":\"/study/React\"},{\"text\":\"Vitepress\",\"link\":\"/study/Vitepress\"}],\"/interview/js\":[{\"text\":\"同步和异步\",\"link\":\"/interview/js/async-sync\"},{\"text\":\"call与apply与bind\",\"link\":\"/interview/js/call-apply-bind\"},{\"text\":\"Class\",\"link\":\"/interview/js/class\"},{\"text\":\"cookie与session与token\",\"link\":\"/interview/js/cookie-session-token\"},{\"text\":\"深浅拷贝\",\"link\":\"/interview/js/copy\"},{\"text\":\"同源策略\",\"link\":\"/interview/js/cors\"},{\"text\":\"设计模式\",\"link\":\"/interview/js/design-patterns\"},{\"text\":\"元素在视口的可见性\",\"link\":\"/interview/js/element-views\"},{\"text\":\"事件循环\",\"link\":\"/interview/js/event-loop\"},{\"text\":\"强弱类型语言\",\"link\":\"/interview/js/language\"},{\"text\":\"模块化\",\"link\":\"/interview/js/module\"},{\"text\":\"原型\",\"link\":\"/interview/js/prototype\"},{\"text\":\"requestAnimation\",\"link\":\"/interview/js/requestAnimation\"},{\"text\":\"手写专区\",\"link\":\"/interview/js/test\"},{\"text\":\"类型转换机制\",\"link\":\"/interview/js/type-conversion\"},{\"text\":\"typeof与instanceof\",\"link\":\"/interview/js/typeof-instanceof\"},{\"text\":\"声明变量的三种方式\",\"link\":\"/interview/js/var\"},{\"text\":\"Web Storage\",\"link\":\"/interview/js/web-storage\"},{\"text\":\"Web Worker\",\"link\":\"/interview/js/web-worker\"}],\"/interview/html\":[{\"text\":\"异步加载脚本\",\"link\":\"/interview/html/async-load\"},{\"text\":\"DOCTYPE的作用\",\"link\":\"/interview/html/doctype\"},{\"text\":\"HTML5新增\",\"link\":\"/interview/html/html5\"},{\"text\":\"src和href的区别\",\"link\":\"/interview/html/src-href\"}],\"/interview/css\":[{\"text\":\"BFC\",\"link\":\"/interview/css/bfc\"},{\"text\":\"包含块\",\"link\":\"/interview/css/containing-block\"},{\"text\":\"magrin的取值\",\"link\":\"/interview/css/margin-padding\"},{\"text\":\"CSS选择器\",\"link\":\"/interview/css/selector\"},{\"text\":\"层叠上下文\",\"link\":\"/interview/css/z-index\"}],\"/question\":[{\"text\":\"css\",\"items\":[{\"text\":\"字体描边\",\"link\":\"/question/css/01\"},{\"text\":\"骨架屏\",\"link\":\"/question/css/02\"}]},{\"text\":\"html\",\"items\":[{\"text\":\"限制文件域上传的类型\",\"link\":\"/question/html/01\"},{\"text\":\"img标签渲染svg\",\"link\":\"/question/html/02\"}]},{\"text\":\"js\",\"items\":[{\"text\":\"系统媒体控制\",\"link\":\"/question/js/01\"},{\"text\":\"浏览器调用输入输出接口\",\"link\":\"/question/js/02\"},{\"text\":\"字符与unicode\",\"link\":\"/question/js/03\"},{\"text\":\"Web Worker\",\"link\":\"/question/js/04\"},{\"text\":\"预览本地图片\",\"link\":\"/question/js/05\"},{\"text\":\"图片的原始尺寸\",\"link\":\"/question/js/06\"},{\"text\":\"拖拽上传\",\"link\":\"/question/js/07\"},{\"text\":\"TouchEvent获取手指相对元素的偏移量\",\"link\":\"/question/js/08\"},{\"text\":\"设计模式\",\"link\":\"/question/js/09\"},{\"text\":\"全屏\",\"link\":\"/question/js/10\"},{\"text\":\"给DOM绑定自定义事件\",\"link\":\"/question/js/11\"},{\"text\":\"PWA\",\"link\":\"/question/js/12\"}]},{\"text\":\"node\",\"items\":[{\"text\":\"响应体类型一览\",\"link\":\"/question/node/01\"},{\"text\":\"下载文件进度\",\"link\":\"/question/node/02\"},{\"text\":\"SSE(服务端推送)\",\"link\":\"/question/node/03\"},{\"text\":\"图片处理\",\"link\":\"/question/node/04\"},{\"text\":\"解析url编码\",\"link\":\"/question/node/05\"},{\"text\":\"__dirname not defined\",\"link\":\"/question/node/06\"},{\"text\":\"媒体流\",\"link\":\"/question/node/07\"},{\"text\":\"base64转图片\",\"link\":\"/question/node/08\"},{\"text\":\"HTTPS 🔒\",\"link\":\"/question/node/09\"},{\"text\":\"大文件上传\",\"link\":\"/question/node/10\"}]},{\"text\":\"other\",\"items\":[{\"text\":\"文件上传\",\"link\":\"/question/other/01\"},{\"text\":\"PE/PC端判断\",\"link\":\"/question/other/02\"},{\"text\":\"图片裁剪\",\"link\":\"/question/other/03\"},{\"text\":\"封装路由参数校验的钩子\",\"link\":\"/question/other/04\"},{\"text\":\"no title\",\"link\":\"/question/other/05\"}]},{\"text\":\"ts\",\"items\":[{\"text\":\"定义window扩展属性\",\"link\":\"/question/ts/01\"},{\"text\":\"TS类型工具\",\"link\":\"/question/ts/02\"},{\"text\":\"第三方库类型支持\",\"link\":\"/question/ts/03\"},{\"text\":\"TS编译JS打包\",\"link\":\"/question/ts/04\"}]},{\"text\":\"vite\",\"items\":[{\"text\":\"获取静态资源路径的函数\",\"link\":\"/question/vite/01\"},{\"text\":\"不同模式下启动项目\",\"link\":\"/question/vite/02\"},{\"text\":\"配置路径别名\",\"link\":\"/question/vite/03\"},{\"text\":\"项目规范化\",\"link\":\"/question/vite/04\"}]},{\"text\":\"vue\",\"items\":[{\"text\":\"封装轮播图组件\",\"link\":\"/question/vue/01\"},{\"text\":\"声明组件实例的类型\",\"link\":\"/question/vue/02\"},{\"text\":\"样式穿透\",\"link\":\"/question/vue/03\"},{\"text\":\"国际化i18n\",\"link\":\"/question/vue/04\"},{\"text\":\"封装模态框\",\"link\":\"/question/vue/05\"},{\"text\":\"JSX in Vue\",\"link\":\"/question/vue/06\"},{\"text\":\"封装鉴权操作组件/指令\",\"link\":\"/question/vue/07\"},{\"text\":\"路由模式\",\"link\":\"/question/vue/08\"},{\"text\":\"命令式组件实践\",\"link\":\"/question/vue/09\"},{\"text\":\"元素共享效果\",\"link\":\"/question/vue/10\"},{\"text\":\"css-in-js\",\"link\":\"/question/vue/11\"},{\"text\":\"指令式预览组件\",\"link\":\"/question/vue/12\"},{\"text\":\"全局组件的 ts 类型提示\",\"link\":\"/question/vue/13\"},{\"text\":\"h函数渲染插槽\",\"link\":\"/question/vue/14\"},{\"text\":\"封装模态框\",\"link\":\"/question/vue/15\"}]}]}},\"locales\":{},\"scrollOffset\":90,\"cleanUrls\":false}");</script>
    
  </body>
</html>